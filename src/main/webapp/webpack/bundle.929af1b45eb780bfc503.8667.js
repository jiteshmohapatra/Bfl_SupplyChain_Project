/*! For license information please see bundle.929af1b45eb780bfc503.8667.js.LICENSE.txt */
(self.webpackChunkopenboxes=self.webpackChunkopenboxes||[]).push([[8667],{41217:function(e,t){!function(e){"use strict";function t(e,t,n,r,o){var a;try{a=n.resolve(e())}catch(e){a=n.reject(e)}return a.then(t,t),r&&a.then(r,o),a}var n=function(){function e(e,t,n){this.func=e,this.Promise=t,this.stamp=n}return e.prototype.delay=function(){var e=this;return this.promise||(this.promise=new this.Promise((function(t,n){e.resolve=t,e.reject=n}))),this.promise},e.prototype.resume=function(e){return t(this.func,e,this.Promise,this.resolve,this.reject)},e}(),r=function(){function e(e,t){var n=void 0===t?{}:t,r=n.getPos,o=n.setPos;this.compare=e,this.heap=[],this.last=0,this.getPos=r,this.setPos=o||function(e,t){}}return e.prototype.clear=function(){this.heap=[],this.last=0},e.prototype.isEmpty=function(){return!this.last},e.prototype.insert=function(e){return this.bubble(e,this.last++)},e.prototype.update=function(e){var t=this.getPos;if(!t)throw new Error("Cannot get index of item in the heap");var n=t(e),r=n-1>>>1,o=this.compare(this.heap[r],e);return o>0?this.bubble(e,n):o<0&&this.sink(e,n),e},e.prototype.peekTop=function(){return this.last?this.heap[0]:null},e.prototype.extractTop=function(){if(!this.last)return null;var e=this.heap[0],t=this.heap[--this.last];return this.heap[this.last]=void 0,this.sink(t,0),e},e.prototype.bubble=function(e,t){for(var n,r,o=this.heap,a=this.compare,i=this.setPos;t>0&&!(a(r=o[n=t-1>>>1],e)<=0);)o[t]=r,i(r,t),t=n;o[t]=e,i(e,t)},e.prototype.sink=function(e,t){for(var n,r,o,a,i,s=this.heap,u=this.last,l=this.compare,c=this.setPos;;){if(n=2*t+1,(r=2*t+2)<u)if(l(a=s[n],i=s[r])<0){if(!(l(a,e)<0))break;o=n}else{if(!(l(i,e)<0))break;o=r}else{if(!(n<u&&l(s[n],e)<0))break;o=n}s[t]=s[o],c(s[t],t),t=o}s[t]=e,c(e,t)},e}(),o=function(){function e(e,t){var n=this;this.Promise=e,this.concurrency=t,this.busyCount=0,this.backlog=new r((function(e,t){return e.stamp-t.stamp})),this.Promise=e,this.concurrency=t,this.nextBound=function(){return n.next(1)},this.nextTickBound=function(){n.timerStamp=0,n.next(0)}}return e.prototype.add=function(e,r){if(void 0===r&&(r=0),this.busyCount<this.concurrency&&!r)return++this.busyCount,t(e,this.nextBound,this.Promise);var o=(new Date).getTime()+r,a=new n(e,this.Promise,o);return this.backlog.insert(a),a.delay()},e.prototype.unblock=function(e){var t=this;this.next(1);var n=function(){return++t.busyCount};return e.then(n,n),e},e.prototype.wrap=function(e,t){var n=this;return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return n.add((function(){return e.apply(t,r)}))}},e.prototype.next=function(e){var t=(new Date).getTime(),n=null;this.busyCount-=e,this.busyCount<this.concurrency&&(n=this.backlog.peekTop()),n&&(n.stamp<=t?(++this.busyCount,(n=this.backlog.extractTop()).resume(this.nextBound)):(!this.timerStamp||n.stamp+1<this.timerStamp)&&(this.timerStamp&&clearTimeout(this.timer),this.timer=setTimeout(this.nextTickBound,~~(n.stamp-t+1)),this.timerStamp=n.stamp))},e}();e.Task=n,e.TaskQueue=o,Object.defineProperty(e,"__esModule",{value:!0})}(t)},75918:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Tt});var r=n(96540),o=n(5556),a=n.n(o),i=n(88600),s=n(697),u=n(8949),l=n(924),c=n(46894),d=n.n(c),p=n(5419),f=n.n(p),m=n(2543),v=n.n(m),h=n(95093),b=n.n(h),y=n(23350),g=n(90952),I=n(84914),S=n.n(I),w=n(41640),k=n(93638),q=n(45814),O=n(33095),P=n(10734),E=n(34297),M=n(33152),R=n(10822),A=n(50709),C=n(83476),T=n(70317),x=n(50946),D=n(43256),N=function(e){return!(null!=e&&e[C.ex.FULL_OUTBOUND_IMPORT])},L=function(e){return(null==e?void 0:e[C.ex.FULL_OUTBOUND_IMPORT])&&!e[C.ex.FULL_OUTBOUND_IMPORT].closed},j=n(26438),V=n(41217);var F=n(51836),B=n(41357);function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function _(e,t,n){return(t=function(e){var t=function(e){if("object"!=U(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=U(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==U(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const G=_(_(_(_({},x.A.SAVED,{icon:r.createElement(B.hm8,null),id:"react.stockMovement.tooltip.itemSaved.label",defaultMessage:"Item saved"}),x.A.PENDING,{icon:r.createElement(B.t09,null),id:"react.stockMovement.tooltip.itemNotSaved.label",defaultMessage:"Item not saved. Fill in the line item details"}),x.A.ERROR,{icon:r.createElement(B.Paf,null),id:"react.stockMovement.tooltip.saveError.label",defaultMessage:"Item not saved. Correct the error"}),x.A.SAVING,{icon:r.createElement(R.A,null),id:"react.stockMovement.tooltip.pendingSave.label",defaultMessage:"Saving in progress"});var W=n(26216),z=function(e){var t=e.lineItemSaveStatus,n=G[t],o=n.icon,a=n.id,u=n.defaultMessage,l=(0,s.d4)((function(e){return(0,W.H)((0,i.ro)(e.localize))}));return r.createElement(F.Tooltip,{html:r.createElement("span",{className:"p-1"},l(a,u)),delay:"150",duration:"250"},r.createElement("div",{className:"".concat(null==t?void 0:t.toLowerCase()," line-item-icon-save-indicator")},o))};const H=z;z.propTypes={lineItemSaveStatus:a().string},z.defaultProps={lineItemSaveStatus:x.A.SAVED};var Y=n(66792);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function Q(){Q=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),s=new A(r||[]);return o(i,"_invoke",{value:P(e,n,s)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",f="suspendedYield",m="executing",v="completed",h={};function b(){}function y(){}function g(){}var I={};l(I,i,(function(){return this}));var S=Object.getPrototypeOf,w=S&&S(S(C([])));w&&w!==n&&r.call(w,i)&&(I=w);var k=g.prototype=b.prototype=Object.create(I);function q(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function n(o,a,i,s){var u=d(e[o],e,a);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==K(c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(c).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,s)}))}s(u.arg)}var a;o(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,o){n(e,r,t,o)}))}return a=a?a.then(o,o):o()}})}function P(t,n,r){var o=p;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var u=E(s,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var l=d(t,n,r);if("normal"===l.type){if(o=r.done?v:f,l.arg===h)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=v,r.method="throw",r.arg=l.arg)}}}function E(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var a=d(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,h;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,h):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function M(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(M,this),this.reset(!0)}function C(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(K(t)+" is not iterable")}return y.prototype=g,o(k,"constructor",{value:g,configurable:!0}),o(g,"constructor",{value:y,configurable:!0}),y.displayName=l(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,u,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},q(O.prototype),l(O.prototype,s,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var i=new O(c(e,n,r,o),a);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},q(k),l(k,u,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;R(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:C(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),h}},t}function $(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,oe(r.key),r)}}function Z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Z=function(){return!!e})()}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t,n){return(t=oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oe(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}var ae={type:k.A,defaultMessage:"Delete",flexWidth:"1",fieldKey:"",buttonLabel:"react.default.button.delete.label",buttonDefaultMessage:"Delete",getDynamicAttr:function(e){var t=e.fieldValue,n=e.removeItem,r=e.removeRow,o=e.showOnly,a=e.updateTotalCount;return{onMouseDown:t&&t.id?function(){n(t.id).then((function(){a(-1),r()}))}:function(){a(-1),r()},disabled:t&&"SUBSTITUTED"===t.statusCode||o}},attributes:{className:"btn btn-outline-danger"}},ie={type:function(e){return r.createElement(H,{lineItemSaveStatus:e.fieldValue})},flexWidth:"0.2"},se={lineItems:{type:w.A,arrowsNavigation:!0,virtualized:!0,totalCount:function(e){return e.totalCount},isRowLoaded:function(e){return e.isRowLoaded},loadMoreRows:function(e){return(0,e.loadMoreRows)()},isFirstPageLoaded:function(e){return e.isFirstPageLoaded},addButton:function(e){var t=e.addRow,n=e.getSortOrder,o=e.showOnly,a=e.updateTotalCount,i=e.getStockMovementDraft,s=e.isDraftAvailable;return r.createElement(r.Fragment,null,r.createElement("button",{type:"button",id:"addButton",className:"btn btn-outline-success btn-xs",disabled:o,onMouseDown:function(){a(1),t({sortOrder:n(),rowSaveStatus:x.A.PENDING})}},r.createElement("span",null,r.createElement("i",{className:"fa fa-plus pr-2"}),r.createElement(W.A,{id:"react.default.button.addLine.label",defaultMessage:"Add line"}))),s&&r.createElement("button",{type:"button",className:"btn btn-outline-primary btn-xs draft-button ml-1",onMouseDown:function(){return i()}},r.createElement(W.A,{id:"react.default.button.availableDraft.label",defaultMessage:"Available draft"})))},fields:{product:{type:O.A,fieldKey:"disabled",label:"react.stockMovement.requestedProduct.label",defaultMessage:"Requested product",headerAlign:"left",flexWidth:"9.5",attributes:{showSelectedOptionColor:!0},getDynamicAttr:function(e){var t=e.fieldValue,n=e.rowIndex,r=e.rowCount,o=e.originId,a=e.focusField;return{disabled:!!t,autoFocus:n===r-1,locationId:o,onExactProductSelected:function(e){var t=e.product;a&&t&&a(n,"quantityRequested")}}}},quantityRequested:{type:E.A,label:"react.stockMovement.quantity.label",defaultMessage:"Quantity",flexWidth:"2.5",attributes:{type:"number"},fieldKey:"",getDynamicAttr:function(e){var t=e.fieldValue,n=e.updateRow,r=e.values,o=e.rowIndex,a=e.saveProgress;return{disabled:(null==t?void 0:t.rowSaveStatus)===x.A.SAVING||t&&"SUBSTITUTED"===t.statusCode||v().isNil(t&&t.product),onBlur:function(){n(r,o),a({values:r})},onChange:function(e){a({values:r,rowIndex:o,fieldValue:ne(ne({},t),{},{quantityRequested:e})})}}}},recipient:{type:P.A,label:"react.stockMovement.recipient.label",defaultMessage:"Recipient",flexWidth:"2.5",fieldKey:"",getDynamicAttr:function(e){var t=e.fieldValue,n=e.recipients,o=e.addRow,a=e.rowCount,i=e.rowIndex,s=e.getSortOrder,u=e.updateTotalCount,l=e.updateRow,c=e.values,p=e.saveProgress,f=e.setRecipientValue,m=e.translate;return{headerHtml:function(){return r.createElement(Y.A,{placeholder:m("react.stockMovement.recipient.label","Recipient"),className:"select-xs my-2",classNamePrefix:"react-select",options:n,onChange:function(e){e&&(f(e),p({editAll:!0,values:d()(c,{lineItems:{$set:c.lineItems.map((function(t){return d()(t,{recipient:{$set:e}})}))}})}))}})},options:n,disabled:(null==t?void 0:t.rowSaveStatus)===x.A.SAVING||t&&"SUBSTITUTED"===t.statusCode||v().isNil(t&&t.product),onTabPress:a===i+1?function(){u(1),o({sortOrder:s(),rowSaveStatus:x.A.PENDING})}:null,arrowRight:a===i+1?function(){u(1),o({sortOrder:s(),rowSaveStatus:x.A.PENDING})}:null,arrowDown:a===i+1?function(){return function(){u(1),o({sortOrder:s(),rowSaveStatus:x.A.PENDING})}}:null,onBlur:function(){l(c,i),p({values:c})},onChange:function(e){p({values:c,rowIndex:i,fieldValue:ne(ne({},t),{},{recipient:e})})}}},attributes:{labelKey:"name",openOnClick:!1}},deleteButton:ae}}},ue={lineItems:{type:w.A,arrowsNavigation:!0,virtualized:!0,showRowSaveIndicator:!0,totalCount:function(e){return e.totalCount},isRowLoaded:function(e){return e.isRowLoaded},loadMoreRows:function(e){return(0,e.loadMoreRows)()},isFirstPageLoaded:function(e){return e.isFirstPageLoaded},addButton:function(e){var t=e.addRow,n=e.getSortOrder,o=e.newItemAdded,a=e.updateTotalCount,i=e.isDraftAvailable,s=e.getStockMovementDraft;return r.createElement(r.Fragment,null,r.createElement("button",{type:"button",id:"addButton",className:"btn btn-outline-success btn-xs",onMouseDown:function(){a(1),t({sortOrder:n(),rowSaveStatus:x.A.PENDING}),o()}},r.createElement("span",null,r.createElement("i",{className:"fa fa-plus pr-2"}),r.createElement(W.A,{id:"react.default.button.addLine.label",defaultMessage:"Add line"}))),i&&r.createElement("button",{type:"button",className:"btn btn-outline-primary btn-xs draft-button ml-1",onMouseDown:function(){return s()}},r.createElement(W.A,{id:"react.default.button.availableDraft.label",defaultMessage:"Available draft"})))},fields:{product:{fieldKey:"disabled",type:O.A,label:"react.stockMovement.requestedProduct.label",defaultMessage:"Requested product",headerAlign:"left",flexWidth:"9",attributes:{showSelectedOptionColor:!0},getDynamicAttr:function(e){var t=e.fieldValue,n=e.rowIndex,r=e.rowCount,o=e.newItem,a=e.originId,i=e.focusField;return{disabled:!!t,autoFocus:o&&n===r-1,locationId:a,onExactProductSelected:function(e){var t=e.product;i&&t&&i(n,"quantityRequested")}}}},quantityAllowed:{type:q.A,label:"react.stockMovement.maxQuantity.label",defaultMessage:"Max Qty",flexWidth:"1.7",attributes:{type:"number"}},quantityRequested:{type:E.A,label:"react.stockMovement.neededQuantity.label",defaultMessage:"Needed Qty",flexWidth:"1.7",attributes:{type:"number"},getDynamicAttr:function(e){var t,n=e.addRow,r=e.rowCount,o=e.rowIndex,a=e.getSortOrder,i=e.updateTotalCount,s=e.updateRow,u=e.values,l=e.saveProgress;return{disabled:(null===(t=u.lineItems[o])||void 0===t?void 0:t.rowSaveStatus)===x.A.SAVING,onTabPress:r===o+1?function(){i(1),n({sortOrder:a(),rowSaveStatus:x.A.PENDING})}:null,arrowRight:r===o+1?function(){i(1),n({sortOrder:a(),rowSaveStatus:x.A.PENDING})}:null,arrowDown:r===o+1?function(){return function(){i(1),n({sortOrder:a(),rowSaveStatus:x.A.PENDING})}}:null,onBlur:function(){s(u,o),l({values:u})},onChange:function(e){l({values:u,rowIndex:o,fieldValue:ne(ne({},u.lineItems[o]),{},{quantityRequested:e})})}}}},deleteButton:ae}}},le=!1,ce=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),re(n=function(e,t,n){return t=J(t),function(e,t){if(t&&("object"==K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Z()?Reflect.construct(t,n||[],J(e).constructor):t.apply(e,n))}(this,t,[e]),"dataFetched",!1),re(n,"saveProgress",(function(e){var t=e.values,r=e.rowIndex,o=e.fieldValue,a=e.editAll;if(n.props.isAutosaveEnabled&&!le){var i=void 0!==r,s=t.lineItems.map((function(e){return a?ne(ne({},e),{},{rowSaveStatus:x.A.PENDING}):i&&r===t.lineItems.indexOf(e)?ne(ne({},o),{},{rowSaveStatus:x.A.PENDING}):e.product&&(0!==e.quantityRequested&&!e.quantityRequested||parseInt(e.quantityRequested,10)<0)?ne(ne({},e),{},{rowSaveStatus:x.A.ERROR}):e}));n.setState({values:ne(ne({},t),{},{lineItems:s})}),i||a?n.debouncedSave():(n.debouncedSave.cancel(),n.saveRequisitionItemsInCurrentStep(s,!1))}})),n.state={currentLineItems:[],sortOrder:0,values:ne(ne({},n.props.initialValues),{},{lineItems:[]}),newItem:!1,totalCount:0,isFirstPageLoaded:!1,isDraftAvailable:!1},n.props.showSpinner(),n.removeItem=n.removeItem.bind(n),n.importTemplate=n.importTemplate.bind(n),n.getSortOrder=n.getSortOrder.bind(n),n.confirmSave=n.confirmSave.bind(n),n.confirmTransition=n.confirmTransition.bind(n),n.newItemAdded=n.newItemAdded.bind(n),n.validate=n.validate.bind(n),n.isRowLoaded=n.isRowLoaded.bind(n),n.loadMoreRows=n.loadMoreRows.bind(n),n.updateTotalCount=n.updateTotalCount.bind(n),n.updateRow=n.updateRow.bind(n),n.getStockMovementDraft=n.getStockMovementDraft.bind(n),n.transitionToNextStep=n.transitionToNextStep.bind(n),n.saveAndTransitionToNextStep=n.saveAndTransitionToNextStep.bind(n),n.didUserConfirmAlert=!1,n.debouncedSave=v().debounce((function(){n.saveRequisitionItemsInCurrentStep(n.state.values.lineItems,!1)}),1e3),n.requestsQueue=(r=new V.TaskQueue(Promise,1),{enqueueRequest:function(e){r.add(e)}}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(t,e),n=t,o=[{key:"componentDidMount",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData());var e=this.props.bars;N(e)&&this.props.createInfoBar(C.zX[C.ex.FULL_OUTBOUND_IMPORT]),L(e)&&this.props.showInfoBar(C.ex.FULL_OUTBOUND_IMPORT)}},{key:"componentWillReceiveProps",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData())}},{key:"componentWillUnmount",value:function(){this.props.hideInfoBar(C.ex.FULL_OUTBOUND_IMPORT)}},{key:"getFields",value:function(){var e=v().get(this.state.values.stocklist,"id")?ue:se,t={lineItems:ne(ne({},e.lineItems),{},{fields:ne(ne({},e.lineItems.fields),{},{rowSaveStatus:ie})})};return this.props.isAutosaveEnabled?t:e}},{key:"getLineItemsToBeSaved",value:function(e){var t=this,n=v().filter(e,(function(e){return!e.statusCode&&parseInt(e.quantityRequested,10)>0&&e.product})),r=v().filter(e,(function(e){return e.statusCode})),o=[];v().forEach(r,(function(e){if(!(0!==e.quantityRequested&&!e.quantityRequested||parseInt(e.quantityRequested,10)<0)){var n=v().find(t.state.currentLineItems,(function(t){return t.id===e.id})),r=parseInt(null==n?void 0:n.quantityRequested,10),a=parseInt(null==e?void 0:e.quantityRequested,10),i=null!=n&&n.recipient&&v().isObject(null==n?void 0:n.recipient)?null==n?void 0:n.recipient.id:null==n?void 0:n.recipient,s=null!=e&&e.recipient&&v().isObject(null==e?void 0:e.recipient)?null==e?void 0:e.recipient.id:null==e?void 0:e.recipient,u=v().remove(v().intersection(v().keys(n),v().keys(e)),(function(e){return"product"!==e}));a===r&&s===i&&t.props.isAutosaveEnabled&&t.setState((function(t){return{values:ne(ne({},t.values),{},{lineItems:t.values.lineItems.map((function(t){return t.id===e.id?ne(ne({},t),{},{rowSaveStatus:x.A.SAVED}):t}))})}})),e.id&&a===r&&0===r?o.push(e):("SUPPLIER"!==t.state.values.origin.type&&t.state.values.hasManageInventory||v().isEqual(v().pick(e,u),v().pick(n,u))&&e.product.id===n.product.id||!e.id)&&(a===r&&s===i||!e.id)||o.push(e)}}));var a=[].concat(v().map(n,(function(e){return{product:{id:e.product.id},quantityRequested:e.quantityRequested,recipient:{id:v().isObject(e.recipient)?e.recipient.id||"":e.recipient||""},sortOrder:e.sortOrder}})),v().map(o,(function(e){return{id:e.id,product:{id:e.product.id},quantityRequested:e.quantityRequested,recipient:{id:v().isObject(e.recipient)?e.recipient.id||"":e.recipient||""},sortOrder:e.sortOrder}})));return this.props.isAutosaveEnabled&&a.length&&this.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:e.values.lineItems.map((function(e){return e.rowSaveStatus===x.A.PENDING&&e.product&&e.quantityRequested?ne(ne({},e),{},{rowSaveStatus:x.A.SAVING}):e}))})}})),a}},{key:"getSortOrder",value:function(){return this.setState((function(e){return{sortOrder:e.sortOrder+100}})),this.state.sortOrder}},{key:"setLineItems",value:function(e,t){var n=this,r=e.data.data,o=r.length?v().map(r,(function(e){return ne(ne({},e),{},{disabled:!0})})):new Array(1).fill({sortOrder:100,rowSaveStatus:x.A.PENDING}),a=v().toInteger(v().last(o).sortOrder)+100;this.props.isAutosaveEnabled&&v().get(this.state.values.stocklist,"id")&&!this.state.isDraftAvailable&&this.saveRequisitionItemsInCurrentStep(r,!1),this.setState((function(e){return{currentLineItems:null!==t&&n.props.isPaginated?v().uniqBy(v().concat(e.currentLineItems,r),"id"):r,values:ne(ne({},e.values),{},{lineItems:null!==t&&n.props.isPaginated?v().uniqBy(v().concat(e.values.lineItems,o),"id"):o}),sortOrder:a}}),(function(){v().isNull(t)||n.state.values.lineItems.length===n.state.totalCount||n.loadMoreRows({startIndex:t+n.props.pageSize}),n.props.hideSpinner()}))}},{key:"getStockMovementDraft",value:function(){var e=this;this.setState((function(t){return{values:ne(ne({},t.values),{},{lineItems:e.props.savedStockMovement.lineItems.map((function(e){return ne(ne({},e),{},{rowSaveStatus:x.A.PENDING})}))}),totalCount:e.props.savedStockMovement.lineItems.length,isDraftAvailable:!1}})),this.saveRequisitionItemsInCurrentStep(this.props.savedStockMovement.lineItems,!0),this.props.hideSpinner()}},{key:"updateTotalCount",value:function(e){this.setState((function(t){return{totalCount:t.totalCount+e===0?1:t.totalCount+e}}))}},{key:"validate",value:function(e){var t={lineItems:[]},n=b()(this.props.minimumExpirationDate,"MM/DD/YYYY");return v().forEach(e.lineItems,(function(e,r){!v().isNil(e.product)&&(0!==e.quantityRequested&&!e.quantityRequested||(null==e?void 0:e.quantityRequested)<0)&&(t.lineItems[r]={quantityRequested:"react.stockMovement.error.enterQuantity.label"}),!v().isEmpty(e.boxName)&&v().isEmpty(e.palletName)&&(t.lineItems[r]={boxName:"react.stockMovement.error.boxWithoutPallet.label"});var o=b()(e.expirationDate,"MM/DD/YYYY");n.diff(o)>0&&(t.lineItems[r]={expirationDate:"react.stockMovement.error.invalidDate.label"})})),t}},{key:"updateRow",value:function(e,t){var n=e.lineItems[t];this.setState({values:d()(e,{lineItems:re({},t,{$set:n})})})}},{key:"newItemAdded",value:function(){this.setState({newItem:!0})}},{key:"confirmSave",value:function(e){var t=this;(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmSave.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmSave.message","Are you sure you want to save? There are some lines with empty or zero quantity, those lines will be deleted."),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){t.didUserConfirmAlert=!0}},{label:this.props.translate("react.default.no.label","No")}],afterClose:function(){t.didUserConfirmAlert&&(e(),t.didUserConfirmAlert=!1)}})}},{key:"confirmTransition",value:function(e,t){(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmTransition.label","You have entered the same code twice. Do you want to continue?"),message:v().map(t,(function(e){var t;return r.createElement("p",{key:e.sortOrder},"".concat(e.product.productCode," ").concat((null===(t=e.product.displayNames)||void 0===t?void 0:t.default)||e.product.name," ").concat(e.quantityRequested))})),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:e},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"fetchAllData",value:function(){this.props.fetchUsers(),this.fetchAddItemsPageData(),this.props.isPaginated||this.fetchLineItems()}},{key:"fetchLineItems",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?stepNumber=2");return D.Ay.get(t).then((function(t){e.setState({totalCount:t.data.data.length||1},(function(){return e.setLineItems(t,null)}))})).catch((function(e){return e}))}},{key:"fetchAddItemsPageData",value:function(){var e=this;this.props.showSpinner();var t=this.props.savedStockMovement,n=t.lastUpdated,r=t.statusCode,o=t.id,a=this.state.values.stockMovementId,i="/api/stockMovements/".concat(a);D.Ay.get(i).then((function(t){var i=t.data.data,s=i.hasManageInventory,u=i.statusCode,l=i.lastUpdated,c=t.data.totalCount,d=e.props.isAutosaveEnabled&&a===o&&l<n&&r===u;e.setState((function(e){return{values:ne(ne({},e.values),{},{hasManageInventory:s,statusCode:u}),totalCount:0===c?1:c,isDraftAvailable:d}}),(function(){return e.props.hideSpinner()}))}))}},{key:"loadMoreRows",value:function(e){var t=this,n=e.startIndex;this.setState({isFirstPageLoaded:!0});var r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?offset=").concat(n,"&max=").concat(this.props.pageSize,"&stepNumber=2");D.Ay.get(r).then((function(e){t.setLineItems(e,n)}))}},{key:"nextPage",value:function(e){var t=this,n=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)&&e.product}));v().some(n,(function(e){return!e.quantityRequested||"0"===e.quantityRequested}))?this.confirmSave((function(){return t.checkDuplicatesAndTransitionToNextStep(n,e)})):this.checkDuplicatesAndTransitionToNextStep(n,e)}},{key:"checkDuplicatesAndTransitionToNextStep",value:function(e,t){var n=this.props.isAutosaveEnabled?this.transitionToNextStep:this.saveAndTransitionToNextStep,r={};v().forEach(e,(function(e){0!==parseInt(e.quantityRequested,10)&&(r[e.product.productCode]?r[e.product.productCode].push(e):r[e.product.productCode]=[e])}));var o=v().filter(r,(function(e){return e.length>1}));v().some(r,(function(e){return e.length>1}))&&"SUPPLIER"!==this.state.values.origin.type&&this.state.values.hasManageInventory?this.confirmTransition((function(){return n(t,e)}),v().reduce(o,(function(e,t){return e.concat(t)}),[])):n(t,e)}},{key:"saveAndTransitionToNextStep",value:function(e,t){var n=this;this.props.showSpinner(),this.saveRequisitionItems(t).then((function(t){t?n.transitionToNextStep({values:ne(ne({},e),{},{lineItems:t.data.data.lineItems})}):n.transitionToNextStep({values:e})})).catch((function(){return n.props.hideSpinner()}))}},{key:"saveRequisitionItems",value:function(e){var t=this.getLineItemsToBeSaved(e),n="/api/stockMovements/".concat(this.state.values.stockMovementId,"/updateItems"),r={id:this.state.values.stockMovementId,lineItems:t};return r.lineItems.length?D.Ay.post(n,r).catch((function(){return Promise.reject(new Error("react.stockMovement.error.saveRequisitionItems.label"))})):Promise.resolve()}},{key:"saveRequisitionItemsInCurrentStep",value:(a=Q().mark((function e(t){var n,r,o,a,i,s,u=this,l=arguments;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(l.length>1&&void 0!==l[1])||l[1],r=t.filter((function(e){return e.rowSaveStatus!==x.A.SAVING})),o=this.getLineItemsToBeSaved(r),a="/api/stockMovements/".concat(this.state.values.stockMovementId,"/updateItems"),!(i={id:this.state.values.stockMovementId,lineItems:o}).lineItems.length){e.next=14;break}if(!this.props.isOnline&&this.props.isAutosaveEnabled&&this.props.addStockMovementDraft({lineItems:t,id:this.state.values.stockMovementId,statusCode:this.state.values.statusCode}),s=function(e){return function(){return D.Ay.post(a,e).then((function(r){var o=r.data.data.lineItems,a=v().map(o,(function(e){return ne(ne({},e),{},{disabled:!0})}));if(n)u.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:a}),currentLineItems:a}}));else{var i,s=null==e||null===(i=e.lineItems)||void 0===i?void 0:i.map((function(e){return e.id})),l=a.map((function(e){return e.id})),c=a.map((function(e){return e.productCode})),d=v().last(v().differenceBy(a,t,"id")),p=u.state.values.lineItems.map((function(e){var t;if(0===parseInt(e.quantityRequested,10)&&(e.rowSaveStatus===x.A.SAVING||e.rowSaveStatus===x.A.SAVED||!e.rowSaveStatus)&&v().includes(s,e.id))return ne(ne({},v().omit(e,["id","statusCode"])),{},{disabled:!0,rowSaveStatus:x.A.SAVED});var n=null!=e&&e.id?s:l;return v().includes(n,e.id)&&e.rowSaveStatus!==x.A.ERROR?ne(ne({},a.find((function(t){return t.id===e.id}))),{},{rowSaveStatus:x.A.SAVED}):d&&v().includes(c,null===(t=e.product)||void 0===t?void 0:t.productCode)&&parseInt(e.quantityRequested,10)>0&&e.rowSaveStatus===x.A.SAVING?ne(ne({},d),{},{disabled:!0,rowSaveStatus:x.A.SAVED}):e}));u.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:p}),currentLineItems:a}}))}})).then((function(){u.props.isAutosaveEnabled&&u.props.removeStockMovementDraft(u.state.values.stockMovementId)})).catch((function(){if(u.props.isAutosaveEnabled){var e=i.lineItems.map((function(e){return e.product.id})),t=u.state.values.lineItems.map((function(t){return t.product&&t.rowSaveStatus===x.A.SAVING&&v().includes(e,t.product.id)?ne(ne({},t),{},{rowSaveStatus:x.A.ERROR}):t}));u.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:t})}})),u.props.isOnline||u.props.addStockMovementDraft({lineItems:u.state.values.lineItems,id:u.state.values.stockMovementId,statusCode:u.state.values.statusCode})}return Promise.reject(new Error(u.props.translate("react.stockMovement.error.saveRequisitionItems.label","Could not save requisition items")))}))}},!this.props.isAutosaveEnabled){e.next=12;break}this.requestsQueue.enqueueRequest(s(i)),e.next=14;break;case 12:return e.next=14,s(i)();case 14:return this.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:e.values.lineItems.map((function(e){return 0!==parseInt(e.quantityRequested,10)||null!=e&&e.id?e:ne(ne({},e),{},{disabled:!0,rowSaveStatus:x.A.SAVED})}))})}})),e.abrupt("return",Promise.resolve());case 16:case"end":return e.stop()}}),e,this)})),i=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=a.apply(e,t);function i(e){$(o,n,r,i,s,"next",e)}function s(e){$(o,n,r,i,s,"throw",e)}i(void 0)}))},function(e){return i.apply(this,arguments)})},{key:"save",value:function(e){var t=this;le=!0;var n=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)}));v().some(n,(function(e){return!e.quantityRequested||"0"===e.quantityRequested}))?this.confirmSave((function(){t.saveItems(n)})):this.saveItems(n)}},{key:"saveAndExit",value:function(e){le=!0,this.validate(e).lineItems.length?(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmExit.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmExit.message","Validation errors occurred. Are you sure you want to exit and lose unsaved data?"),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){window.location=A.ti.show(e.stockMovementId)}},{label:this.props.translate("react.default.no.label","No")}]}):this.saveRequisitionItemsInCurrentStep(e.lineItems).then((function(){window.location=A.ti.show(e.stockMovementId)}))}},{key:"saveItems",value:function(e){var t=this;this.props.showSpinner(),this.saveRequisitionItemsInCurrentStep(e).then((function(){t.fetchLineItems(),t.props.removeStockMovementDraft(t.state.values.stockMovementId),t.props.hideSpinner(),S().success(t.props.translate("react.stockMovement.alert.saveSuccess.label","Changes saved successfully"),{timeout:3e3})})).catch((function(){return t.props.hideSpinner()})).finally((function(){le=!1}))}},{key:"refresh",value:function(){var e=this;(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmRefresh.label","Confirm refresh"),message:this.props.translate("react.stockMovement.confirmRefresh.message","Are you sure you want to refresh? Your progress since last save will be lost."),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){return e.fetchAllData()}},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"removeItem",value:function(e){var t=this,n="/api/stockMovementItems/".concat(e,"/removeItem"),r={stockMovementId:this.state.values.stockMovementId};return D.Ay.delete(n,{data:r}).then((function(){t.props.isOnline||t.props.addStockMovementDraft({lineItems:t.state.values.lineItems,id:t.state.values.stockMovementId,statusCode:t.state.values.statusCode})})).catch((function(){return t.props.hideSpinner(),Promise.reject(new Error("react.stockMovement.error.deleteRequisitionItem.label"))}))}},{key:"removeAll",value:function(){var e=this;le=!0;var t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/removeAllItems");return D.Ay.delete(t).then((function(){e.props.removeStockMovementDraft(e.state.values.stockMovementId),e.setState((function(e){return{totalCount:1,currentLineItems:[],values:ne(ne({},e.values),{},{lineItems:new Array(1).fill({sortOrder:100,rowSaveStatus:x.A.PENDING})})}}))})).catch((function(){return e.fetchLineItems(),Promise.reject(new Error("react.stockMovement.error.deleteRequisitionItem.label"))})).finally((function(){le=!1}))}},{key:"transitionToNextStep",value:function(e){var t=this,n=e.values,r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/status"),o={status:"REQUESTED"};this.props.showSpinner(),new Promise((function(e){return"CREATED"===t.state.values.statusCode&&e(D.Ay.post(r,o)),e()})).then(this.props.nextPage(n||this.state.values)).finally(this.props.hideSpinner())}},{key:"exportTemplate",value:function(e){var t=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)}));this.saveItemsAndExportTemplate(e,t)}},{key:"isRowLoaded",value:function(e){var t=e.index;return!!this.state.values.lineItems[t]}},{key:"saveItemsAndExportTemplate",value:function(e,t){var n=this;this.props.showSpinner();var r=e.movementNumber,o=e.stockMovementId,a="/stockMovement/exportCsv/".concat(o);this.saveRequisitionItemsInCurrentStep(t).then((function(){D.Ay.get(a,{responseType:"blob"}).then((function(e){f()(e.data,"ItemList".concat(r?"-".concat(r):"",".csv"),"text/csv"),n.props.hideSpinner()})).catch((function(){return n.props.hideSpinner()}))}))}},{key:"showPendingSaveNotification",value:function(){(0,M.A)(T.A.INFO)({message:this.props.translate("react.notification.autosave.pending.label","Please wait while your line items are being saved.")})}},{key:"importTemplate",value:function(e){var t=this;this.props.showSpinner();var n=new FormData,r=e.target.files[0],o=this.state.values.stockMovementId;n.append("importFile",r.slice(0,r.size,"text/csv"));var a="/stockMovement/importCsv/".concat(o);return D.Ay.post(a,n,{headers:{"content-type":"multipart/form-data"}}).then((function(){t.fetchLineItems(),v().isNil(v().last(t.state.values.lineItems).product)&&t.setState((function(e){return{values:ne(ne({},e.values),{},{lineItems:[]})}}))})).catch((function(){t.props.hideSpinner()}))}},{key:"previousPage",value:function(e,t){var n=this;t?(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmPreviousPage.label","Validation error"),message:this.props.translate("react.stockMovement.confirmPreviousPage.message.label","Cannot save due to validation error on page"),buttons:[{label:this.props.translate("react.stockMovement.confirmPreviousPage.correctError.label","Correct error")},{label:this.props.translate("react.stockMovement.confirmPreviousPage.continue.label","Continue (lose unsaved work)"),onClick:function(){return n.props.previousPage(e)}}]}):this.saveRequisitionItemsInCurrentStep(e.lineItems).then((function(){return n.props.previousPage(e)}))}},{key:"render",value:function(){var e=this,t=this.props.showOnly;return r.createElement(r.Fragment,null,r.createElement(g.lV,{onSubmit:function(){},validate:this.validate,mutators:ne(ne({},l.A),{},{setColumnValue:j.UM}),initialValues:this.state.values,render:function(n){var o=n.handleSubmit,a=n.values,i=n.invalid,s=n.form.mutators;return r.createElement("div",{className:"d-flex flex-column"},t?r.createElement("button",{type:"button",disabled:i,onClick:function(){e.props.history(A.ti.listOutbound())},className:"float-right mb-1 btn btn-outline-danger align-self-end btn-xs mr-2"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(W.A,{id:"react.default.button.exit.label",defaultMessage:"Exit"}))):r.createElement("span",{className:"buttons-container"},r.createElement("label",{htmlFor:"csvInput",className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-download pr-2"}),r.createElement(W.A,{id:"react.default.button.importTemplate.label",defaultMessage:"Import template"})),r.createElement("input",{id:"csvInput",type:"file",style:{display:"none"},onChange:e.importTemplate,onClick:function(e){e.target.value=null},accept:".csv"})),r.createElement("button",{type:"button",onClick:function(){return e.exportTemplate(a)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-upload pr-2"}),r.createElement(W.A,{id:"react.default.button.exportTemplate.label",defaultMessage:"Export template"}))),r.createElement("button",{type:"button",onClick:function(){return e.refresh()},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-refresh pr-2"}),r.createElement(W.A,{id:"react.default.button.refresh.label",defaultMessage:"Reload"}))),r.createElement("button",{type:"button",disabled:i,onClick:function(){return e.removeAll()},className:"float-right mb-1 btn btn-outline-danger align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-remove pr-2"}),r.createElement(W.A,{id:"react.default.button.deleteAll.label",defaultMessage:"Delete all"}))),r.createElement("button",{type:"button",disabled:i,onMouseDown:function(){return e.save(a)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",{className:"saving-button"},v().some(a.lineItems,(function(e){return e.rowSaveStatus===x.A.SAVING}))?r.createElement(R.A,null):r.createElement("i",{className:"fa fa-save pr-2"}),r.createElement(W.A,{id:"react.default.button.save.label",defaultMessage:"Save"}))),r.createElement("button",{type:"button",disabled:i,onMouseDown:function(){return e.saveAndExit(a)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(W.A,{id:"react.default.button.saveAndExit.label",defaultMessage:"Save and exit"})))),r.createElement("form",{onSubmit:o},r.createElement("div",{className:"table-form"},v().map(e.getFields(),(function(n,r){return(0,j.bl)(n,r,{stocklist:a.stocklist,recipients:e.props.recipients,removeItem:e.removeItem,originId:e.props.initialValues.origin.id,getSortOrder:e.getSortOrder,newItemAdded:e.newItemAdded,newItem:e.state.newItem,totalCount:e.state.totalCount,loadMoreRows:e.loadMoreRows,isRowLoaded:e.isRowLoaded,updateTotalCount:e.updateTotalCount,isPaginated:e.props.isPaginated,isFromOrder:e.state.values.isFromOrder,showOnly:t,updateRow:e.updateRow,values:a,isFirstPageLoaded:e.state.isFirstPageLoaded,saveProgress:e.saveProgress,getStockMovementDraft:e.getStockMovementDraft,isDraftAvailable:e.state.isDraftAvailable,isAutosaveEnabled:e.props.isAutosaveEnabled,setRecipientValue:function(e){return s.setColumnValue("lineItems","recipient",e)},translate:e.props.translate})}))),r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"button",disabled:i||t||v().some(a.lineItems,(function(e){return e.quantityRequested<0})),onMouseDown:function(){e.props.isAutosaveEnabled&&v().some(a.lineItems,(function(e){return(e.rowSaveStatus===x.A.PENDING||e.rowSaveStatus===x.A.SAVING)&&e.product}))?e.showPendingSaveNotification():e.previousPage(a,i)},className:"btn btn-outline-primary btn-form btn-xs"},r.createElement(W.A,{id:"react.default.button.previous.label",defaultMessage:"Previous"})),r.createElement("button",{type:"submit",onMouseDown:function(){e.props.isAutosaveEnabled&&v().some(a.lineItems,(function(e){return e.rowSaveStatus===x.A.PENDING||e.rowSaveStatus===x.A.SAVING}))?e.showPendingSaveNotification():i||e.nextPage(a)},className:"btn btn-outline-primary btn-form float-right btn-xs",disabled:0===a.lineItems.length||1===a.lineItems.length&&!("product"in a.lineItems[0])||i||t||v().some(a.lineItems,(function(e){return e.quantityRequested<0}))||v().every(a.lineItems,(function(e){return 0===parseInt(e.quantityRequested,10)}))},r.createElement(W.A,{id:"react.default.button.next.label",defaultMessage:"Next"})))))}}))}}],o&&X(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,a,i}(r.Component),de={showSpinner:u.xc,hideSpinner:u.W$,fetchUsers:u.hU,addStockMovementDraft:u.k0,removeStockMovementDraft:u.Fh,createInfoBar:u.CV,hideInfoBar:u.K7,closeInfoBar:u.mk,showInfoBar:u.xC};const pe=(0,s.Ng)((function(e,t){return{recipients:e.users.data,translate:(0,W.H)((0,i.ro)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,minimumExpirationDate:e.session.minimumExpirationDate,hasPackingSupport:e.session.currentLocation.hasPackingSupport,isPaginated:e.session.isPaginated,pageSize:e.session.pageSize,savedStockMovement:e.stockMovementDraft[t.initialValues.id],isOnline:e.connection.online,isAutosaveEnabled:e.session.isAutosaveEnabled,supportedActivities:e.session.supportedActivities,bars:e.infoBar.bars}}),de)(ce);ce.propTypes={initialValues:a().shape({origin:a().shape({id:a().string}),hasManageInventory:a().bool}).isRequired,previousPage:a().func.isRequired,nextPage:a().func.isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,fetchUsers:a().func.isRequired,recipients:a().arrayOf(a().shape({})).isRequired,translate:a().func.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,minimumExpirationDate:a().string.isRequired,isPaginated:a().bool.isRequired,showOnly:a().bool,pageSize:a().number.isRequired,addStockMovementDraft:a().func.isRequired,removeStockMovementDraft:a().func.isRequired,savedStockMovement:a().shape({id:a().string,lineItems:a().arrayOf(a().shape({})),lastUpdated:a().string,statusCode:null}),isOnline:a().bool,isAutosaveEnabled:a().bool,createInfoBar:a().func.isRequired,bars:a().arrayOf(a().shape({name:a().string.isRequired,show:a().bool.isRequired,closed:a().bool,title:a().shape({label:a().string.isRequired,defaultLabel:a().string.isRequired}),versionLabel:a().shape({label:a().string.isRequired,defaultLabel:a().string.isRequired})})).isRequired,showInfoBar:a().func.isRequired,hideInfoBar:a().func.isRequired,history:a().shape({push:a().func}).isRequired},ce.defaultProps={showOnly:!1,savedStockMovement:{id:null,lineItems:[],lastUpdated:null,statusCode:null},isOnline:!0,isAutosaveEnabled:!1};var fe=n(84976),me=n(79738),ve=n(70373),he=n.n(ve),be=n(76477),ye=n(91019);function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}var Ie=["name","locationType"];function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(e,t,n){return(t=Oe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Oe(r.key),r)}}function Oe(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ge(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}function Pe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Pe=function(){return!!e})()}function Ee(e){return Ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ee(e)}function Me(e,t){return Me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Me(e,t)}function Re(e){var t={};return e.name||(t.name="react.default.error.requiredField.label"),e.locationType||(t.locationType="react.default.error.requiredField.label"),["address","address2","city","stateOrProvince","postalCode","country"].reduce((function(t,n){return t||!!e[n]}),!1)&&!e.address&&(t.address="react.default.error.requiredField.label"),t}var Ae={name:{type:E.A,label:"react.locationsConfiguration.name.label",defaultMessage:"Name",attributes:{required:!0}},locationType:{type:P.A,label:"react.locationsConfiguration.locationType.label",defaultMessage:"Location Type",attributes:{className:"multi-select location-select",required:!0,valueKey:"id"},getDynamicAttr:function(e){return{options:e.locationTypes}}}},Ce={address:{type:E.A,label:"react.locationsConfiguration.address.street.label",defaultMessage:"Street address"},address2:{type:E.A,label:"react.locationsConfiguration.address.street2.label",defaultMessage:"Street address 2"},city:{type:E.A,label:"react.locationsConfiguration.address.city.label",defaultMessage:"City"},stateOrProvince:{type:E.A,label:"react.locationsConfiguration.address.stateOrProvince.label",defaultMessage:"State/Province"},postalCode:{type:E.A,label:"react.locationsConfiguration.address.postalCode.label",defaultMessage:"Postal code"},country:{type:E.A,label:"react.locationsConfiguration.address.country.label",defaultMessage:"Country"}},Te=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Ee(t),function(e,t){if(t&&("object"==ge(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pe()?Reflect.construct(t,n||[],Ee(e).constructor):t.apply(e,n))}(this,t,[e])).mapToOptionsList=n.mapToOptionsList.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Me(e,t)}(t,e),n=t,o=[{key:"componentDidMount",value:function(){this.props.fetchLocationTypes({params:{activityCode:be.A.DYNAMIC_CREATION}})}},{key:"mapToOptionsList",value:function(e){var t=this;return v().map(e,(function(e){return we(we({},e),{},{label:(0,ye.Ay)(e.name,t.props.locale)})}))}},{key:"save",value:function(e){var t=this;this.props.showSpinner();var n=e.name,r=e.locationType,o=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,Ie),a={name:n,locationType:v().get(r,"id")||""};D.Ay.post("/api/locations?useDefaultActivities=true",a).then((function(e){return S().success(t.props.translate("react.stockMovement.success.createDestination.label","Destination was successfully created!"),{timeout:3e3}),e.data.data})).then((function(e){if(t.props.onResponse(e),!v().isEmpty(o)){var n="/api/locations/".concat(e.id);return D.Ay.post(n,(0,D.iR)({address:o}))}return Promise.resolve()})).then((function(){t.props.hideSpinner(),t.props.onClose()})).catch((function(){return t.props.hideSpinner(),Promise.reject(new Error(t.props.translate("react.stockMovement.error.createDestination.label","Could not create destination")))}))}},{key:"render",value:function(){var e=this;return r.createElement(he(),{isOpen:this.props.isOpen,className:"modal-content",shouldCloseOnOverlayClick:!1},r.createElement("div",null,r.createElement("h4",null,r.createElement(W.A,{id:"react.stockMovement.addDestination.label",defaultMessage:"Add Destination"})),r.createElement(g.lV,{onSubmit:function(t){return e.save(t)},validate:Re,render:function(t){var n=t.handleSubmit,o=t.values;return r.createElement("form",{id:"modalForm",onSubmit:n},r.createElement("div",{className:"classic-form location-field-rows"},v().map(Ae,(function(t,n){return(0,j.bl)(t,n,{values:o,locationTypes:e.mapToOptionsList(e.props.locationTypes)})})),v().map(Ce,(function(e,t){return(0,j.bl)(e,t)}))),r.createElement("div",{className:"btn-toolbar justify-content-between pt-3"},r.createElement("button",{type:"button",className:"btn btn-outline-primary ml-1",onClick:function(){return e.props.onClose()}},r.createElement(W.A,{id:"react.default.button.cancel.label",defaultMessage:"Cancel"})),r.createElement("button",{type:"submit",className:"btn btn-primary align-self-end"},r.createElement(W.A,{id:"react.default.button.save.label",defaultMessage:"Save"}))))}})))}}],o&&qe(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const xe=(0,fe.withRouter)((0,s.Ng)((function(e){return{locale:e.session.activeLanguage,translate:(0,W.H)((0,i.ro)(e.localize)),locationTypes:e.location.locationTypes}}),{showSpinner:u.xc,hideSpinner:u.W$,fetchTranslations:u.dj,fetchLocationTypes:u.br})(Te));Te.propTypes={locale:a().string.isRequired,hideSpinner:a().func.isRequired,isOpen:a().bool.isRequired,onClose:a().func.isRequired,onResponse:a().func.isRequired,showSpinner:a().func.isRequired,translate:a().func.isRequired,fetchLocationTypes:a().func.isRequired,locationTypes:a().arrayOf(a().shape({})).isRequired};var De=n(24178);function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?je(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fe(e,t,n){return(t=Ue(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ue(r.key),r)}}function Ue(e){var t=function(e){if("object"!=Ne(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ne(t)?t:t+""}function _e(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_e=function(){return!!e})()}function Ge(e){return Ge=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ge(e)}function We(e,t){return We=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},We(e,t)}function ze(e){var t={};if(e.description||(t.description="react.default.error.requiredField.label"),e.origin||(t.origin="react.default.error.requiredField.label"),e.destination||(t.destination="react.default.error.requiredField.label"),e.requestedBy||(t.requestedBy="react.default.error.requiredField.label"),e.requestType||(t.requestType="react.default.error.requiredField.label"),e.dateRequested){var n=b()(e.dateRequested,"MM/DD/YYYY");b()().diff(n)<0&&(t.dateRequested="react.stockMovement.error.futureDate.label")}else t.dateRequested="react.default.error.requiredField.label";return t}var He={description:{type:E.A,label:"react.stockMovement.description.label",defaultMessage:"Description",attributes:{required:!0,autoFocus:!0}},origin:{type:P.A,label:"react.stockMovement.origin.label",defaultMessage:"Origin",attributes:{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedLocationsFetch,onChange:function(t){t&&e.destination&&e.destination.id&&e.fetchStockLists(t,e.destination)},disabled:!e.isSuperuser}}},destination:{type:P.A,label:"react.stockMovement.destination.label",defaultMessage:"Destination",attributes:{createNewFromModal:!0,createNewFromModalLabel:"react.stockMovement.addDestination.label",defaultMessage:"Add Destination",required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){var t=e.debouncedLocationsFetch,n=e.origin,r=e.fetchStockLists;return{loadOptions:t,newOptionModalOpen:e.openNewLocationModal,createNewFromModal:!!e.locationTypes.length,onChange:function(e){e&&n&&n.id&&r(n,e)}}}},requestedBy:{type:P.A,label:"react.stockMovement.requestedBy.label",defaultMessage:"Requested by",attributes:{async:!0,required:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],labelKey:"name",filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedPeopleFetch}}},dateRequested:{type:me.A,label:"react.stockMovement.dateRequested.label",defaultMessage:"Date requested",attributes:{required:!0,localizeDate:!0,autoComplete:"off"}},requestType:{type:P.A,label:"react.stockMovement.requestType.label",defaultMessage:"Request type",attributes:{required:!0,showValueTooltip:!0},getDynamicAttr:function(e){return{options:e.requestTypes}}},stocklist:{label:"react.stockMovement.stocklist.label",defaultMessage:"Stocklist",type:P.A,getDynamicAttr:function(e){var t=e.origin,n=e.destination,r=e.stocklists,o=e.setRequestType,a=e.values;return{disabled:!(t&&n&&t.id&&n.id),options:r,showValueTooltip:!0,valueKey:"id",labelKey:"name",onChange:function(e){e&&o(a,e)}}}}},Ye=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Ge(t),function(e,t){if(t&&("object"==Ne(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_e()?Reflect.construct(t,n||[],Ge(e).constructor):t.apply(e,n))}(this,t,[e])).state={stocklists:[],setInitialValues:!0,values:n.props.initialValues,requestTypes:[],showDestinationModal:!1},n.fetchStockLists=n.fetchStockLists.bind(n),n.setRequestType=n.setRequestType.bind(n),n.debouncedPeopleFetch=(0,De.tF)(n.props.debounceTime,n.props.minSearchLength),n.debouncedLocationsFetch=(0,De.Uq)(n.props.debounceTime,n.props.minSearchLength),n.openAddDestinationModal=n.openAddDestinationModal.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&We(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.state.values.origin&&this.state.values.destination&&this.fetchStockLists(this.state.values.origin,this.state.values.destination),this.fetchRequisitionTypes();var e=this.props.bars;N(e)&&this.props.createInfoBar(C.zX[C.ex.FULL_OUTBOUND_IMPORT]),L(e)&&this.props.showInfoBar(C.ex.FULL_OUTBOUND_IMPORT)}},{key:"componentWillReceiveProps",value:function(e){!this.props.match.params.stockMovementId&&this.state.setInitialValues&&e.location.id&&this.setInitialValues(e.location)}},{key:"componentWillUnmount",value:function(){this.props.hideInfoBar(C.ex.FULL_OUTBOUND_IMPORT)}},{key:"setRequestType",value:function(e,t){var n=this.state.requestTypes,r=v().find(n,(function(e){return"STOCK"===e.value}));this.setState({values:d()(e,{requestType:{$set:r},stocklist:{$set:t}})})}},{key:"setInitialValues",value:function(e){var t=e.id,n=e.locationType,r=e.name,o={origin:{id:t,type:n?n.locationTypeCode:null,name:r,label:"".concat(r," [").concat(n?n.description:null,"]")}};this.setState({values:o,setInitialValues:!1})}},{key:"openAddDestinationModal",value:function(){this.setState({showDestinationModal:!0})}},{key:"fetchRequisitionTypes",value:function(){var e=this;return D.Ay.get("/api/getRequestTypes").then((function(t){var n=v().map(t.data.data,(function(e){return{value:e.id,label:e.name}}));e.setState({requestTypes:n},(function(){return e.props.hideSpinner()}))})).catch((function(){return e.props.hideSpinner()}))}},{key:"checkStockMovementChange",value:function(e){var t=this.props.initialValues,n=t.origin,r=t.destination,o=t.stocklist,a=e.origin&&n,i=n&&"SUPPLIER"===n.type,s=e.origin&&"SUPPLIER"===e.type,u=!(!a||i&&(!i||s))&&e.origin.id!==n.id,l=!!(o&&e.destination&&r)&&e.destination.id!==r.id,c=!!e.stockMovementId&&v().get(e.stocklist,"id",null)!==v().get(o,"id",null);return u||l||c}},{key:"fetchStockLists",value:function(e,t,n){var r=this;this.props.showSpinner();var o="/api/stocklists?origin=".concat(e.id,"&destination=").concat(t.id);return D.Ay.get(o).then((function(e){var t=v().map(e.data.data,(function(e){return{id:e.id,name:e.name,value:e.id,label:e.name}}));!v().find(t,(function(e){return e.value.id===v().get(r.state.values,"stocklist.id")}))&&n&&n(),r.setState({stocklists:t},(function(){return r.props.hideSpinner()}))})).catch((function(){return r.props.hideSpinner()}))}},{key:"saveStockMovement",value:function(e){var t=this;if(e.origin&&e.destination&&e.requestedBy&&e.dateRequested&&e.description){this.props.showSpinner();var n;n=e.stockMovementId?"/api/stockMovements/".concat(e.stockMovementId,"/updateRequisition"):"/api/stockMovements";var r={name:"",description:e.description,dateRequested:e.dateRequested,origin:{id:e.origin.id},destination:{id:e.destination.id},requestedBy:{id:e.requestedBy.id},stocklist:{id:v().get(e.stocklist,"id")||""},requestType:e.requestType.value};D.Ay.post(n,r).then((function(n){if(n.data){var r=n.data.data;t.props.history.push(A.ti.editOutbound(r.id)),t.props.nextPage(Ve(Ve({},e),{},{stockMovementId:r.id,lineItems:r.lineItems,movementNumber:r.identifier,name:r.name,stocklist:r.stocklist,requestType:{name:r.requestType.name,label:r.requestType.name}}))}})).catch((function(){return t.props.hideSpinner(),Promise.reject(new Error(t.props.translate("react.stockMovement.error.createStockMovement.label","Could not create stock movement")))}))}}},{key:"resetToInitialValues",value:function(){var e=this;this.setState({values:{}},(function(){return e.setState({values:e.props.initialValues})}))}},{key:"nextPage",value:function(e){var t=this;this.checkStockMovementChange(e)?(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmChange.label","Confirm change"),message:this.props.translate("react.stockMovement.confirmChange.message","Do you want to change stock movement data? Changing origin, destination or stock list can cause loss of your current work"),buttons:[{label:this.props.translate("react.default.no.label","No"),onClick:function(){return t.resetToInitialValues()}},{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){return t.saveStockMovement(e)}}]}):this.saveStockMovement(e)}},{key:"render",value:function(){var e=this;return r.createElement(g.lV,{onSubmit:function(t){return e.nextPage(t)},validate:ze,initialValues:this.state.values,mutators:{clearStocklist:function(e,t,n){n.changeValue(t,"stocklist",(function(){return null}))},setDestinationValues:function(e,t,n){var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Le(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,1)[0],o=r.id,a=r.name,i=r.locationType,s={id:o,value:o,label:"".concat(a," [").concat(i?i.description:null,"]")};n.changeValue(t,"destination",(function(){return s}))}},render:function(t){var n=t.form.mutators,o=t.handleSubmit,a=t.values;return r.createElement(r.Fragment,null,r.createElement(xe,{isOpen:e.state.showDestinationModal,onClose:function(){return e.setState({showDestinationModal:!1})},onResponse:n.setDestinationValues}),r.createElement("form",{onSubmit:o},r.createElement("div",{className:"classic-form with-description"},v().map(He,(function(t,r){return(0,j.bl)(t,r,{stocklists:e.state.stocklists,fetchStockLists:function(t,r){return e.fetchStockLists(t,r,n.clearStocklist)},origin:a.origin,destination:a.destination,isSuperuser:e.props.isSuperuser,debouncedPeopleFetch:e.debouncedPeopleFetch,debouncedLocationsFetch:e.debouncedLocationsFetch,requestTypes:e.state.requestTypes,setRequestType:e.setRequestType,openNewLocationModal:e.openAddDestinationModal,locationTypes:e.props.locationTypes,values:a})}))),r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"submit",className:"btn btn-outline-primary float-right btn-xs"},r.createElement(W.A,{id:"react.default.button.next.label",defaultMessage:"Next"})))))}})}}])&&Be(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component),Ke={showSpinner:u.xc,hideSpinner:u.W$,createInfoBar:u.CV,hideInfoBar:u.K7,closeInfoBar:u.mk,showInfoBar:u.xC};const Qe=(0,fe.withRouter)((0,s.Ng)((function(e){return{location:e.session.currentLocation,isSuperuser:e.session.isSuperuser,translate:(0,W.H)((0,i.ro)(e.localize)),debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength,locationTypes:e.location.locationTypes,bars:e.infoBar.bars}}),Ke)(Ye));Ye.propTypes={match:a().shape({params:a().shape({stockMovementId:a().string})}).isRequired,initialValues:a().shape({origin:a().shape({id:a().string}),destination:a().shape({id:a().string}),stocklist:a().shape({})}).isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,nextPage:a().func.isRequired,history:a().shape({push:a().func}).isRequired,location:a().shape({name:a().string,id:a().string,locationType:a().shape({description:a().string,locationTypeCode:a().string})}).isRequired,isSuperuser:a().bool.isRequired,translate:a().func.isRequired,debounceTime:a().number.isRequired,minSearchLength:a().number.isRequired,locationTypes:a().arrayOf(a().shape({})).isRequired,createInfoBar:a().func.isRequired,bars:a().arrayOf(a().shape({name:a().string.isRequired,show:a().bool.isRequired,closed:a().bool,title:a().shape({label:a().string.isRequired,defaultLabel:a().string.isRequired}),versionLabel:a().shape({label:a().string.isRequired,defaultLabel:a().string.isRequired})})).isRequired,showInfoBar:a().func.isRequired,hideInfoBar:a().func.isRequired};var $e=n(95212),Xe=n(20655),Ze=n(98966),Je=n(33274),et=n(44323);function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function nt(e){return function(e){if(Array.isArray(e))return rt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return rt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function at(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){ct(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,dt(r.key),r)}}function st(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(st=function(){return!!e})()}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}function lt(e,t){return lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},lt(e,t)}function ct(e,t,n){return(t=dt(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dt(e){var t=function(e){if("object"!=tt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==tt(t)?t:t+""}var pt={YES:"btn btn-outline-success",NO:"btn btn-outline-secondary",EARLIER:"btn btn-outline-warning",HIDDEN:"btn invisible"},ft={editPageItems:{type:w.A,arrowsNavigation:!0,virtualized:!0,totalCount:function(e){return e.totalCount},isRowLoaded:function(e){return e.isRowLoaded},isFirstPageLoaded:function(e){return e.isFirstPageLoaded},loadMoreRows:function(e){return(0,e.loadMoreRows)()},rowComponent:Xe.A,getDynamicRowAttr:function(e){var t=e.rowValues,n=e.subfield,r=e.showOnlyErroredItems,o=e.itemFilter,a="SUBSTITUTED"===t.statusCode?"crossed-out ":"";t.quantityAvailable<t.quantityRequested&&(a+="font-weight-bold");var i=o&&!(0,et.ut)({product:null==t?void 0:t.product,filterValue:o});return{className:a,hideRow:(r&&!t.hasError||i)&&!n}},subfieldKey:"substitutionItems",fields:{productCode:{type:q.A,headerAlign:"left",flexWidth:"0.6",getDynamicAttr:function(e){return{className:e.subfield?"text-center":"text-left ml-1"}},label:"react.stockMovement.code.label",defaultMessage:"Code",attributes:{showValueTooltip:!0}},product:{type:q.A,headerAlign:"left",flexWidth:"3.5",label:"react.stockMovement.productName.label",defaultMessage:"Product name",attributes:{formatValue:et.OL},getDynamicAttr:function(e){var t,n=e.subfield,r=e.fieldValue;return{color:null==r?void 0:r.color,className:n?"text-center":"text-left ml-1",showValueTooltip:!(null==r||null===(t=r.displayNames)||void 0===t||!t.default),tooltipValue:null==r?void 0:r.name}}},quantityRequested:{type:q.A,label:"react.stockMovement.requested.label",defaultMessage:"Requested",flexWidth:"1.1",headerAlign:"right",attributes:{className:"text-right",formatValue:function(e){return e?e.toLocaleString("en-US"):e}}},quantityOnHand:{type:q.A,label:"react.stockMovement.onHand.label",defaultMessage:"On Hand",flexWidth:"1",fieldKey:"",getDynamicAttr:function(e){var t=e.fieldValue,n="text-right";return t&&(!t.quantityOnHand||t.quantityOnHand<t.quantityRequested)&&(n="".concat(n," text-danger")),{className:n}},headerAlign:"right",attributes:{formatValue:function(e){return e.quantityOnHand?e.quantityOnHand.toLocaleString("en-US"):e.quantityOnHand}}},quantityAvailable:{type:q.A,label:"react.stockMovement.available.label",defaultMessage:"Available",flexWidth:"1",fieldKey:"",getDynamicAttr:function(e){var t=e.fieldValue,n="text-right";return t&&(!t.quantityAvailable||t.quantityAvailable<t.quantityRequested)&&(n="".concat(n," text-danger")),{className:n}},headerAlign:"right",attributes:{formatValue:function(e){return e.quantityAvailable?e.quantityAvailable.toLocaleString("en-US"):e.quantityAvailable}}},quantityDemandFulfilling:{type:q.A,label:"react.stockMovement.demandPerMonth.label",defaultMessage:"Demand per Month",flexWidth:"1.5",getDynamicAttr:function(){return{formatValue:function(e){return e&&"0"!==e?e.toLocaleString("en-US"):"0"},showValueTooltip:!0}},headerAlign:"right",attributes:{className:"text-right"}},detailsButton:{label:"react.stockMovement.details.label",defaultMessage:"Details",type:Ze.A,flexWidth:"1",fieldKey:"",attributes:{title:"react.stockMovement.pendingRequisitionDetails.label",defaultTitleMessage:"Pending Requisition Details"},getDynamicAttr:function(e){var t,n=e.fieldValue,r=e.stockMovementId,o=e.values;return{productId:n&&n.product&&n.product.id,productCode:n&&n.product&&n.product.productCode,productName:n&&n.product&&n.product.name,displayName:null==n||null===(t=n.product)||void 0===t||null===(t=t.displayNames)||void 0===t?void 0:t.default,originId:o&&o.origin&&o.origin.id,stockMovementId:r,quantityRequested:n&&n.quantityRequested,quantityOnHand:n&&n.quantityOnHand,quantityAvailable:n&&n.quantityAvailable,btnOpenText:"react.stockMovement.details.label",btnOpenDefaultText:"Details",btnCancelText:"Close",btnSaveStyle:{display:"none"},btnContainerClassName:"float-right",btnOpenAsIcon:!0,btnOpenStyle:{border:"none",cursor:"pointer"},btnOpenIcon:"fa-search"}}},substituteButton:{label:"react.stockMovement.substitution.label",defaultMessage:"Substitution",type:Je.A,fieldKey:"",flexWidth:"1",attributes:{title:"react.stockMovement.substitutes.label",defaultTitleMessage:"Substitutes"},getDynamicAttr:function(e){var t=e.fieldValue,n=e.rowIndex,r=e.stockMovementId,o=e.onResponse,a=e.reviseRequisitionItems,i=e.values,s=e.reasonCodes,u=e.showOnly;return{onOpen:function(){return a(i)},productCode:t&&t.productCode,btnOpenText:"react.stockMovement.".concat(t&&t.substitutionStatus,".label"),btnOpenDefaultText:"".concat(t&&t.substitutionStatus),btnOpenDisabled:t&&"SUBSTITUTED"===t.statusCode||u,btnOpenClassName:pt[t&&t.substitutionStatus||"HIDDEN"],rowIndex:n,lineItem:t,stockMovementId:r,onResponse:o,reasonCodes:s}}},quantityRevised:{label:"react.stockMovement.quantityRevised.label",defaultMessage:"Qty revised",type:E.A,fieldKey:"statusCode",flexWidth:"1",attributes:{type:"number"},getDynamicAttr:function(e){var t=e.fieldValue,n=e.subfield,r=e.showOnly,o=e.updateRow,a=e.values,i=e.rowIndex;return{disabled:t&&"SUBSTITUTED"===t||n||r,onBlur:function(){return o(a,i)}}}},reasonCode:{type:P.A,label:"react.stockMovement.reasonCode.label",defaultMessage:"Reason code",flexWidth:"1.4",fieldKey:"quantityRevised",getDynamicAttr:function(e){var t=e.fieldValue,n=e.subfield,r=e.reasonCodes,o=e.updateRow,a=e.values,i=e.rowIndex,s=t&&"SUBSTITUTED"===t.statusCode;return{disabled:null==t||n||s,options:r,showValueTooltip:!0,onBlur:function(){return o(a,i)}}}},revert:{type:k.A,label:"react.default.button.undo.label",defaultMessage:"Undo",flexWidth:"1",fieldKey:"",buttonLabel:"react.default.button.undo.label",buttonDefaultMessage:"Undo",getDynamicAttr:function(e){var t=e.fieldValue,n=e.revertItem,r=e.values,o=e.showOnly;return{onClick:t&&t.requisitionItemId?function(){return n(r,t.requisitionItemId)}:function(){return null},hidden:!(!t||!t.statusCode||v().includes(["CHANGED","CANCELED"],t.statusCode)),disabled:o}},attributes:{className:"btn btn-outline-danger"}}}}};function mt(e){var t={editPageItems:[]};return v().forEach(e.editPageItems,(function(e,n){!v().isEmpty(e.quantityRevised)&&v().isEmpty(e.reasonCode)?t.editPageItems[n]={reasonCode:"react.stockMovement.errors.reasonCodeRequired.label"}:v().isNil(e.quantityRevised)&&!v().isEmpty(e.reasonCode)&&"SUBSTITUTED"!==e.statusCode&&(t.editPageItems[n]={quantityRevised:"react.stockMovement.errors.revisedQuantityRequired.label"}),parseInt(e.quantityRevised,10)===e.quantityRequested&&(t.editPageItems[n]={quantityRevised:"react.stockMovement.errors.sameRevisedQty.label"}),!v().isEmpty(e.quantityRevised)&&e.quantityAvailable>=0&&e.quantityRevised>e.quantityAvailable&&(t.editPageItems[n]={quantityRevised:"react.stockMovement.errors.higherQty.label"}),!v().isEmpty(e.quantityRevised)&&e.quantityRevised<0&&(t.editPageItems[n]={quantityRevised:"react.stockMovement.errors.negativeQty.label"})})),t}var vt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),ct(n=function(e,t,n){return t=ut(t),function(e,t){if(t&&("object"==tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,st()?Reflect.construct(t,n||[],ut(e).constructor):t.apply(e,n))}(this,t,[e]),"dataFetched",!1),n.state={statusCode:"",revisedItems:[],values:at(at({},n.props.initialValues),{},{editPageItems:[]}),hasItemsLoaded:!1,totalCount:0,isFirstPageLoaded:!1,showOnlyErroredItems:!1,itemFilter:""},n.revertItem=n.revertItem.bind(n),n.fetchEditPageItems=n.fetchEditPageItems.bind(n),n.reviseRequisitionItems=n.reviseRequisitionItems.bind(n),n.isRowLoaded=n.isRowLoaded.bind(n),n.loadMoreRows=n.loadMoreRows.bind(n),n.updateRow=n.updateRow.bind(n),n.markErroredLines=n.markErroredLines.bind(n),n.validate=n.validate.bind(n),n.props.showSpinner(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lt(e,t)}(t,e),n=t,o=[{key:"componentDidMount",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:"componentWillReceiveProps",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData(!1)),e.currentLocale!==this.props.currentLocale&&this.props.fetchReasonCodes()}},{key:"setEditPageItems",value:function(e,t){var n=this;this.props.showSpinner();var r=e.data.data,o=v().map(r,(function(e){return at(at({},e),{},{disabled:!0,quantityOnHand:e.quantityOnHand>0?e.quantityOnHand:0,quantityAvailable:e.quantityAvailable>0?e.quantityAvailable:0,product:at(at({},e.product),{},{label:"".concat(e.productCode," ").concat(e.productName)}),reasonCode:v().find(n.props.reasonCodes,(function(t){var n=t.value;return v().includes(e.reasonCode,n)})),substitutionItems:v().map(e.substitutionItems,(function(t){return at(at({},t),{},{reasonCode:v().find(n.props.reasonCodes,(function(t){var n=t.value;return v().includes(e.reasonCode,n)})),requisitionItemId:e.requisitionItemId,product:at(at({},t.product),{},{label:"".concat(t.productCode," ").concat(t.productName)})})}))})}));this.setState((function(e){return{revisedItems:v().filter(o,(function(e){return"CHANGED"===e.statusCode})),values:at(at({},e.values),{},{editPageItems:v().uniqBy(v().concat(e.values.editPageItems,o),"requisitionItemId")}),hasItemsLoaded:e.hasItemsLoaded||e.totalCount===v().uniqBy(v().concat(e.values.editPageItems,o),"requisitionItemId").length}}),(function(){v().isNull(t)||n.state.values.editPageItems.length===n.state.totalCount||n.loadMoreRows({startIndex:t+n.props.pageSize}),n.props.hideSpinner()}))}},{key:"validate",value:function(e){var t=mt(e);return v().forEach(e.editPageItems,(function(e,n){v().isNil(e.quantityRevised)&&e.quantityRequested>e.quantityAvailable&&"SUBSTITUTED"!==e.statusCode&&(t.editPageItems[n]={quantityRevised:"react.stockMovement.errors.lowerQty.label"})})),this.markErroredLines(e,t),t}},{key:"markErroredLines",value:function(e,t){var n=e;v().forEach(this.state.values.editPageItems,(function(e,r){n=d()(n,{editPageItems:ct({},r,{hasError:{$set:!!v().find(t.editPageItems,(function(e,t){return r===t}))}})})})),this.setState((function(e){return{values:n,showOnlyErroredItems:!!t.editPageItems.length&&e.showOnlyErroredItems}}))}},{key:"fetchAllData",value:function(e){var t=this;this.props.showSpinner(),this.props.fetchReasonCodes(),this.fetchEditPageData().then((function(n){var r=n.data.data.statusCode,o=n.data.totalCount;t.setState({statusCode:r,totalCount:o},(function(){t.props.isPaginated&&!e||t.fetchItems()}))})).catch((function(){t.props.hideSpinner()}))}},{key:"fetchItems",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?stepNumber=3");D.Ay.get(t).then((function(t){e.setEditPageItems(t,null),e.setState({hasItemsLoaded:!0})}))}},{key:"fetchEditPageItems",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?stepNumber=3");D.Ay.get(t).then((function(t){var n=t.data.data;e.setState((function(t){return{hasItemsLoaded:!0,values:at(at({},t.values),{},{editPageItems:v().map(n,(function(t){return at(at({},t),{},{quantityOnHand:t.quantityOnHand||0,reasonCode:v().find(e.props.reasonCodes,(function(e){var n=e.value;return v().includes(t.reasonCode,n)})),substitutionItems:v().map(t.substitutionItems,(function(n){return at(at({},n),{},{reasonCode:v().find(e.props.reasonCodes,(function(e){var n=e.value;return v().includes(t.reasonCode,n)})),requisitionItemId:t.requisitionItemId})}))})}))})}}),(function(){e.fetchAllData(!1),e.props.hideSpinner()}))})).catch((function(){e.props.hideSpinner()}))}},{key:"loadMoreRows",value:function(e){var t=this,n=e.startIndex;if(this.state.totalCount){this.setState({isFirstPageLoaded:!0});var r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?offset=").concat(n,"&max=").concat(this.props.pageSize,"&stepNumber=3");D.Ay.get(r).then((function(e){t.setEditPageItems(e,n)}))}}},{key:"isRowLoaded",value:function(e){var t=e.index;return!!this.state.values.editPageItems[t]}},{key:"reviseRequisitionItems",value:function(e){var t=this,n=v().filter(e.editPageItems,(function(e){if(e.quantityRevised&&e.reasonCode){var n=v().find(t.state.revisedItems,(function(t){return t.requisitionItemId===e.requisitionItemId}));return!!v().isEmpty(n)||v().toInteger(n.quantityRevised)!==v().toInteger(e.quantityRevised)||n.reasonCode!==e.reasonCode}return!1})),r=e;v().forEach(n,(function(e){var n=v().findIndex(t.state.values.editPageItems,(function(t){return e.requisitionItemId===t.requisitionItemId}));r=d()(r,{editPageItems:ct({},n,{statusCode:{$set:"CHANGED"}})})})),this.setState({values:r});var o="/api/stockMovements/".concat(this.state.values.stockMovementId,"/reviseItems"),a={lineItems:v().map(n,(function(e){return{id:e.requisitionItemId,quantityRevised:e.quantityRevised,reasonCode:e.reasonCode.value}}))};return a.lineItems.length?D.Ay.post(o,a):Promise.resolve()}},{key:"updateRow",value:function(e,t){var n,r=e.editPageItems[t];n=d()(e,{editPageItems:ct({},t,{$set:r})}),this.setState({values:n})}},{key:"save",value:function(e){var t=this;this.props.showSpinner();var n=mt(e).editPageItems;return n.length?((0,et.aA)({translate:this.props.translate,errors:n}),this.props.hideSpinner(),null):this.reviseRequisitionItems(e).then((function(e){var n=JSON.parse(e.config.data);if(n.lineItems&&n.lineItems.length){var r=n.lineItems.map((function(e){return e.id})),o=n.lineItems.map((function(e){return at(at({},e),{},{requisitionItemId:e.id,reasonCode:v().find(t.props.reasonCodes,(function(t){var n=t.value;return v().includes(e.reasonCode,n)}))})})),a=v().filter(t.state.values.editPageItems,(function(e){return r.indexOf(e.requisitionItemId)<0}));t.setState({revisedItems:[].concat(nt(a),nt(o))})}t.props.hideSpinner(),S().success(t.props.translate("react.stockMovement.alert.saveSuccess.label","Changes saved successfully"),{timeout:3e3})})).catch((function(){return t.props.hideSpinner()}))}},{key:"reload",value:function(){this.setState({revisedItems:[],values:at(at({},this.props.initialValues),{},{editPageItems:[]}),hasItemsLoaded:!1,totalCount:0,isFirstPageLoaded:!1}),this.fetchAllData(!0)}},{key:"refresh",value:function(){var e=this;(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmRefresh.label","Confirm refresh"),message:this.props.translate("react.stockMovement.confirmRefresh.message","Are you sure you want to refresh? Your progress since last save will be lost."),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){return e.reload()}},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"transitionToNextStep",value:function(){var e="/api/stockMovements/".concat(this.state.values.stockMovementId,"/status"),t={status:"PICKING",createPicklist:"REQUESTED"===this.state.statusCode?"true":"false"};return D.Ay.post(e,t)}},{key:"fetchEditPageData",value:function(){var e="/api/stockMovements/".concat(this.state.values.stockMovementId);return D.Ay.get(e).then((function(e){return e})).catch((function(e){return e}))}},{key:"nextPage",value:function(e){var t=this;this.props.showSpinner(),this.reviseRequisitionItems(e).then((function(){t.transitionToNextStep().then((function(){return t.props.nextPage(e)})).catch((function(){return t.reload()}))})).catch((function(){return t.props.hideSpinner()}))}},{key:"updateEditPageItem",value:function(e,t){var n=v().findIndex(this.state.values.editPageItems,(function(e){return e.requisitionItemId===t.requisitionItemId})),r=v().findIndex(this.state.revisedItems,(function(e){return e.requisitionItemId===t.requisitionItemId}));this.setState((function(o){return{values:at(at({},e),{},{editPageItems:d()(e.editPageItems,ct({},n,{$set:at(at({},t),{},{quantityOnHand:t.quantityOnHand||0,quantityAvailable:t.quantityAvailable||0,substitutionItems:v().map(t.substitutionItems,(function(e){return at(at({},e),{},{requisitionItemId:t.requisitionItemId})}))})}))}),revisedItems:d()(o.revisedItems,r>-1?{$splice:[[r,1]]}:{})}}))}},{key:"saveAndExit",value:function(e){mt(e).editPageItems.length?((0,y.ZX)({title:this.props.translate("react.stockMovement.confirmExit.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmExit.message","Validation errors occurred. Are you sure you want to exit and lose unsaved data?"),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){window.location=A.ti.show(e.stockMovementId)}},{label:this.props.translate("react.default.no.label","No")}]}),this.props.hideSpinner()):this.reviseRequisitionItems(e).then((function(){window.location=A.ti.show(e.stockMovementId)}))}},{key:"revertItem",value:function(e,t){var n=this;this.props.showSpinner();var r="/api/stockMovementItems/".concat(t,"/revertItem"),o="/api/stockMovementItems/".concat(t,"?stepNumber=3");return D.Ay.post(r).then((function(){return D.Ay.get(o).then((function(t){var r=t.data.data;n.updateEditPageItem(e,r),n.props.hideSpinner()})).catch((function(){return n.props.hideSpinner(),Promise.reject(new Error(n.props.translate("react.stockMovement.error.revertRequisitionItem.label","Could not revert requisition items")))}))})).catch((function(){return n.props.hideSpinner(),Promise.reject(new Error(n.props.translate("react.stockMovement.error.revertRequisitionItem.label","Could not revert requisition items")))}))}},{key:"previousPage",value:function(e,t){var n=this;t?(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmPreviousPage.label","Validation error"),message:this.props.translate("react.stockMovement.confirmPreviousPage.message.label","Cannot save due to validation error on page"),buttons:[{label:this.props.translate("react.stockMovement.confirmPreviousPage.correctError.label","Correct error")},{label:this.props.translate("react.stockMovement.confirmPreviousPage.continue.label","Continue (lose unsaved work)"),onClick:function(){return n.props.previousPage(e)}}]}):this.reviseRequisitionItems(e).then((function(){return n.props.previousPage(e)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.showOnlyErroredItems,o=t.itemFilter,a=this.props.showOnly,i=this.state.values&&this.state.values.editPageItems.length>0?v().filter(this.state.values.editPageItems,(function(e){return e.hasError})).length:"0";return r.createElement(g.lV,{onSubmit:function(){},validate:this.validate,mutators:at({},l.A),initialValues:this.state.values,render:function(t){var s=t.handleSubmit,u=t.values,l=t.invalid;return r.createElement("div",{className:"d-flex flex-column"},a?r.createElement("button",{type:"button",onClick:function(){e.props.history.push(A.ti.listOutbound())},className:"float-right mb-1 btn btn-outline-danger align-self-end btn-xs mr-2"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"})," ",r.createElement(W.A,{id:"react.default.button.exit.label",defaultMessage:"Exit"})," ")):r.createElement("span",{className:"buttons-container"},r.createElement($e.A,{itemFilter:o,onChange:function(t){return e.setState({itemFilter:t.target.value})},onClear:function(){return e.setState({itemFilter:""})}}),r.createElement("button",{type:"button",onClick:function(){return e.setState({showOnlyErroredItems:!n})},className:"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs ml-3 ".concat(n?"active":"")},r.createElement("span",null,i," ",r.createElement(W.A,{id:"react.stockMovement.erroredItemsCount.label",defaultMessage:"item(s) require your attention"}))),r.createElement("button",{type:"button",onClick:function(){return e.refresh()},className:"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs ml-3"},r.createElement("span",null,r.createElement("i",{className:"fa fa-refresh pr-2"}),r.createElement(W.A,{id:"react.default.button.refresh.label",defaultMessage:"Reload"}))),r.createElement("button",{type:"button",onClick:function(){return e.save(u)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-3 btn-xs ml-3"},r.createElement("span",null,r.createElement("i",{className:"fa fa-save pr-2"}),r.createElement(W.A,{id:"react.default.button.save.label",defaultMessage:"Save"}))),r.createElement("button",{type:"button",onClick:function(){return e.saveAndExit(u)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-3 btn-xs ml-3"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(W.A,{id:"react.default.button.saveAndExit.label",defaultMessage:"Save and exit"})))),r.createElement("form",{onSubmit:s},r.createElement("div",{className:"table-form"},v().map(ft,(function(t,r){return(0,j.bl)(t,r,{stockMovementId:u.stockMovementId,translate:e.props.translate,reasonCodes:e.props.reasonCodes,onResponse:e.fetchEditPageItems,revertItem:e.revertItem,reviseRequisitionItems:e.reviseRequisitionItems,totalCount:e.state.totalCount,loadMoreRows:e.loadMoreRows,isRowLoaded:e.isRowLoaded,isPaginated:e.props.isPaginated,updateRow:e.updateRow,isFirstPageLoaded:e.state.isFirstPageLoaded,values:u,showOnly:a,showOnlyErroredItems:n,itemFilter:o})}))),r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"submit",onClick:function(){return e.previousPage(u,l)},disabled:a,className:"btn btn-outline-primary btn-form btn-xs"},r.createElement(W.A,{id:"react.default.button.previous.label",defaultMessage:"Previous"})),r.createElement("button",{type:"submit",disabled:!e.state.hasItemsLoaded||a,onClick:function(){l||e.nextPage(u)},className:"btn btn-outline-primary btn-form float-right btn-xs"},r.createElement(W.A,{id:"react.default.button.next.label",defaultMessage:"Next"})))))}})}}],o&&it(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const ht=(0,fe.withRouter)((0,s.Ng)((function(e){return{reasonCodes:e.reasonCodes.data,translate:(0,W.H)((0,i.ro)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,isPaginated:e.session.isPaginated,pageSize:e.session.pageSize,currentLocale:e.session.activeLanguage}}),{fetchReasonCodes:u.xH,showSpinner:u.xc,hideSpinner:u.W$})(vt));vt.propTypes={initialValues:a().shape({}).isRequired,previousPage:a().func.isRequired,nextPage:a().func.isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,fetchReasonCodes:a().func.isRequired,reasonCodes:a().arrayOf(a().shape({})).isRequired,translate:a().func.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,isPaginated:a().bool.isRequired,showOnly:a().bool.isRequired,pageSize:a().number.isRequired,currentLocale:a().string.isRequired,history:a().shape({push:a().func}).isRequired};var bt=n(74167),yt=n(45066),gt=n(15945),It=n(80461),St=n(39802);function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){Rt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,At(r.key),r)}}function Pt(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Pt=function(){return!!e})()}function Et(e){return Et=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Et(e)}function Mt(e,t){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Mt(e,t)}function Rt(e,t,n){return(t=At(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function At(e){var t=function(e){if("object"!=wt(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=wt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==wt(t)?t:t+""}var Ct=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Rt(n=function(e,t,n){return t=Et(t),function(e,t){if(t&&("object"==wt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Pt()?Reflect.construct(t,n||[],Et(e).constructor):t.apply(e,n))}(this,t,[e]),"dataFetched",!1),n.state={values:n.props.initialValues,currentPage:1},n.updateWizardValues=n.updateWizardValues.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Mt(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.props.fetchTranslations("","stockMovement"),this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:"componentWillReceiveProps",value:function(e){this.props.locale&&this.props.locale!==e.locale&&this.props.fetchTranslations(e.locale,"stockMovement"),e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:"stepList",get:function(){return this.props.hasPackingSupport?[this.props.translate("react.stockMovement.create.label","Create"),this.props.translate("react.stockMovement.addItems.label","Add items"),this.props.translate("react.stockMovement.edit.label","Edit"),this.props.translate("react.stockMovement.pick.label","Pick"),this.props.translate("react.stockMovement.pack.label","Pack"),this.props.translate("react.stockMovement.send.label","Send")]:[this.props.translate("react.stockMovement.create.label","Create"),this.props.translate("react.stockMovement.addItems.label","Add items"),this.props.translate("react.stockMovement.edit.label","Edit"),this.props.translate("react.stockMovement.pick.label","Pick"),this.props.translate("react.stockMovement.send.label","Send")]}},{key:"pageList",get:function(){return this.props.hasPackingSupport?[Qe,pe,ht,yt.A,bt.A,gt.A]:[Qe,pe,ht,yt.A,gt.A]}},{key:"wizardTitle",get:function(){var e=this.state.values;return e.movementNumber||e.trackingNumber?[{text:this.props.translate("react.stockMovement.label","Stock Movement"),color:"#000000",delimeter:" | "},{text:e.movementNumber,color:"#000000",delimeter:" - "},{text:e.origin.name,color:"#004d40",delimeter:" ".concat(this.props.translate("react.default.to.label","to")," ")},{text:e.destination.name,color:"#01579b",delimeter:", "},{text:this.props.formatLocalizedDate(e.dateRequested,St.A.COMMON),color:"#4a148c",delimeter:", "},{text:e.description,color:"#770838",delimeter:""}]:[]}},{key:"additionalWizardTitle",get:function(){var e=this.state,t=e.currentPage,n=e.values,o=n.shipped?this.props.translate("react.stockMovement.status.shipped.label","SHIPPED"):"",a=n.received?this.props.translate("react.stockMovement.status.received.label","RECEIVED"):"";return this.props.hasPackingSupport&&6===t||!this.props.hasPackingSupport&&5===t?r.createElement("span",{className:"shipment-status float-right"},"".concat(o||a||this.props.translate("react.stockMovement.status.pending.label","PENDING"))):null}},{key:"updateWizardValues",value:function(e,t){this.setState({currentPage:e,values:t})}},{key:"fetchInitialValues",value:function(){var e=this;if(this.props.match.params.stockMovementId){this.props.showSpinner();var t="/api/stockMovements/".concat(this.props.match.params.stockMovementId);D.Ay.get(t).then((function(t){var n=t.data.data,r=n.origin.locationType,o=n.destination.locationType,a=qt(qt({},n),{},{stockMovementId:n.id,movementNumber:n.identifier,origin:{id:n.origin.id,type:r?r.locationTypeCode:null,name:n.origin.name,label:"".concat(n.origin.name," [").concat(r?r.description:null,"]")},destination:{id:n.destination.id,type:o?o.locationTypeCode:null,name:n.destination.name,label:"".concat(n.destination.name," [").concat(o?o.description:null,"]")},requestedBy:{id:n.requestedBy.id,name:n.requestedBy.name,label:n.requestedBy.name},requestType:{name:n.requestType.name,label:n.requestType.name}}),i=1;switch(a.statusCode){case"NEW":break;case"CREATED":case"REQUESTING":i=2;break;case"REQUESTED":case"VALIDATING":i=3;break;case"VALIDATED":case"PICKING":i=4;break;case"PICKED":case"PACKING":i=5;break;default:i=e.props.hasPackingSupport?6:5}e.setState({values:a,currentPage:i})})).catch((function(){return e.props.hideSpinner()}))}}},{key:"render",value:function(){var e=this.state,t=e.values,n=e.currentPage,o=this.props.currentLocation,a=t.origin&&t.origin.id!==o.id;return r.createElement(It.A,{pageList:this.pageList,stepList:this.stepList,initialValues:t,title:this.wizardTitle,additionalTitle:this.additionalWizardTitle,currentPage:n,prevPage:1===n?1:n-1,updateWizardValues:this.updateWizardValues,additionalProps:{showOnly:a}})}}])&&Ot(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const Tt=(0,s.Ng)((function(e){return{locale:e.session.activeLanguage,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,translate:(0,W.H)((0,i.ro)(e.localize)),hasPackingSupport:e.session.currentLocation.hasPackingSupport,currentLocation:e.session.currentLocation,formatLocalizedDate:(0,ye.Yq)(e.localize)}}),{showSpinner:u.xc,hideSpinner:u.W$,fetchTranslations:u.dj})(Ct);Ct.propTypes={match:a().shape({params:a().shape({stockMovementId:a().string})}).isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,locale:a().string.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,fetchTranslations:a().func.isRequired,translate:a().func.isRequired,hasPackingSupport:a().bool.isRequired,currentLocation:a().shape({id:a().string}).isRequired,initialValues:a().shape({shipmentStatus:a().string}),formatLocalizedDate:a().func.isRequired},Ct.defaultProps={initialValues:{}}}}]);
//# sourceMappingURL=bundle.929af1b45eb780bfc503.8667.js.map