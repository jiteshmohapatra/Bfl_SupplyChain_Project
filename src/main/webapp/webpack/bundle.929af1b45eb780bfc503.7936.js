"use strict";(self.webpackChunkopenboxes=self.webpackChunkopenboxes||[]).push([[7936],{13077:(e,t,n)=>{n.d(t,{A:()=>g});var r=n(96540),o=n(5556),a=n.n(o),i=n(697),s=n(51836),l=n(24178),c=n(88024),u=n(66792),d=["onExactProductSelected","locationId","fieldRef","includeUom"];function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},p.apply(null,arguments)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var v=function(e){var t=e.productCode,n=e.displayName,r=e.displayNames,o=e.name;return"".concat(t," - ").concat(n||(null==r?void 0:r.default)||o)},b=function(e){var t;return r.createElement(s.Tooltip,{html:r.createElement("div",{className:"text-truncate"},e.name),theme:"transparent",disabled:!(e.displayName||null!==(t=e.displayNames)&&void 0!==t&&t.default),position:"top-start"},r.createElement("strong",{style:{color:e.color||"black"},className:"d-flex align-items-center"},e.label||v(e),"Â ",(0,c.A)(e.handlingIcons)))},h=function(e){return r.createElement("span",{className:"d-flex align-items-center"},r.createElement("span",{style:{color:e.showSelectedOptionColor&&e.color},className:"text-truncate"},e.label||v(e)),(0,c.A)(null==e?void 0:e.handlingIcons))},y=function(e){var t=e.onExactProductSelected,n=e.locationId,o=e.fieldRef,a=e.includeUom,s=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,d),c=(0,r.useRef)(null),f=m((0,r.useState)(!1),2),v=f[0],y=f[1],g=m((0,r.useState)([]),2),k=g[0],S=g[1],w=m((0,r.useState)(""),2),M=w[0],O=w[1],E=(0,i.d4)((function(e){return{debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength}})),I=E.debounceTime,P=E.minSearchLength,D=(0,l.yH)(I,P,n,{includeUom:a});return(0,r.useEffect)((function(){if(v&&k.length&&M){var e=k.filter((function(e){return e.exactMatch})),n=null;if(1===e.length){var r=m(e,1);n=r[0]}else if(e.length>1){var o=e.find((function(e){return e.productCode===M}));o&&(n=o)}n&&c.current.select.select.setValue(n),t&&setTimeout((function(){return t({product:n})}),0),y(!1),S([])}}),[v,k,M]),r.createElement(u.A,p({},s,{fieldRef:function(e){c.current=e,o&&o(e)},async:!0,options:[],loadOptions:s.loadOptions||function(e,t){return D(e,(function(n){S(n),O(e),t(n)}))},onMenuClose:function(){S([]),O("")},filterOption:function(e){return e},onEnterPress:function(e){e.preventDefault(),e.stopPropagation(),y(!0)},optionRenderer:b,valueRenderer:h}))};y.defaultProps={className:"text-left",openOnClick:!0,autoload:!0,cache:!1,showValueTooltip:!0,onExactProductSelected:void 0,fieldRef:void 0,loadOptions:void 0,includeUom:!1},y.propTypes={className:a().string,openOnClick:a().bool,autoload:a().bool,cache:a().bool,showValueTooltip:a().bool,locationId:a().string.isRequired,onExactProductSelected:a().func,fieldRef:a().func,loadOptions:a().func,includeUom:a().bool};const g=y},17077:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ve});var r=n(96540),o=n(5556),a=n.n(o),i=n(88600),s=n(697),l=n(8949),c=n(924),u=n(46894),d=n.n(u),p=n(5419),m=n.n(p),f=n(2543),v=n.n(f),b=n(95093),h=n.n(b),y=n(23350),g=n(90952),k=n(84914),S=n.n(k),w=n(41640),M=n(93638),O=n(79738),E=n(33095),I=n(10734),P=n(34297),D=n(50709),A=n(43256),x=n(26438),N=n(66792),C=n(26216);function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,z(r.key),r)}}function L(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(L=function(){return!!e})()}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},F(e)}function V(e,t){return V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},V(e,t)}function B(e,t,n){return(t=z(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e){var t=function(e){if("object"!=R(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=R(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==R(t)?t:t+""}var Y={type:M.A,label:"react.default.button.delete.label",defaultMessage:"Delete",flexWidth:"1",fieldKey:"",buttonLabel:"react.default.button.delete.label",buttonDefaultMessage:"Delete",getDynamicAttr:function(e){var t=e.fieldValue,n=e.removeItem,r=e.removeRow,o=e.updateTotalCount;return{onClick:t&&t.id?function(){n(t.id).then((function(){o(-1),r()}))}:function(){o(-1),r()},disabled:t&&"SUBSTITUTED"===t.statusCode}},attributes:{className:"btn btn-outline-danger"}},_={lineItems:{type:w.A,arrowsNavigation:!0,virtualized:!0,totalCount:function(e){return e.totalCount},isRowLoaded:function(e){return e.isRowLoaded},loadMoreRows:function(e){return(0,e.loadMoreRows)()},isFirstPageLoaded:function(e){return e.isFirstPageLoaded},addButton:function(e){var t=e.addRow,n=e.getSortOrder,o=e.isFromOrder,a=e.updateTotalCount;return r.createElement("button",{type:"button",className:"btn btn-outline-success btn-xs",hidden:o,onClick:function(){a(1),t({sortOrder:n()})}},r.createElement("span",null,r.createElement("i",{className:"fa fa-plus pr-2"}),r.createElement(C.A,{id:"react.default.button.addLine.label",defaultMessage:"Add line"})))},fields:{palletName:{type:P.A,label:"react.stockMovement.packLevel1.label",defaultMessage:"Pack level 1",flexWidth:"1",getDynamicAttr:function(e){var t=e.rowIndex,n=e.rowCount,r=e.updateRow,o=e.values;return{autoFocus:t===n-1,onBlur:function(){return r(o,t)}}}},boxName:{type:P.A,label:"react.stockMovement.packLevel2.label",defaultMessage:"Pack level 2",flexWidth:"1",getDynamicAttr:function(e){var t=e.rowIndex,n=e.values,r=e.updateRow;return{onBlur:function(){return r(n,t)}}}},product:{type:E.A,label:"react.stockMovement.product.label",defaultMessage:"Product",headerAlign:"left",flexWidth:"4",required:!0,attributes:{showSelectedOptionColor:!0},getDynamicAttr:function(e){var t=e.updateRow,n=e.rowIndex,r=e.values,o=e.originId,a=e.focusField;return{locationId:o,onExactProductSelected:function(e){var t=e.product;a&&t&&a(n,"quantityRequested")},onBlur:function(){return t(r,n)}}}},lotNumber:{type:P.A,label:"react.stockMovement.lot.label",defaultMessage:"Lot",flexWidth:"1",getDynamicAttr:function(e){var t=e.rowIndex,n=e.values,r=e.updateRow;return{onBlur:function(){return r(n,t)}}}},expirationDate:{type:O.A,label:"react.stockMovement.expiry.label",defaultMessage:"Expiry",flexWidth:"1.5",attributes:{localizeDate:!0,showLocalizedPlaceholder:!0,autoComplete:"off"},getDynamicAttr:function(e){var t=e.rowIndex,n=e.values,r=e.updateRow;return{onBlur:function(){return r(n,t)}}}},quantityRequested:{type:P.A,label:"react.stockMovement.quantity.label",defaultMessage:"Qty",flexWidth:"1",required:!0,attributes:{type:"number"},getDynamicAttr:function(e){var t=e.rowIndex,n=e.values,r=e.updateRow;return{onBlur:function(){return r(n,t)}}}},recipient:{type:I.A,label:"react.stockMovement.recipient.label",defaultMessage:"Recipient",flexWidth:"1.5",getDynamicAttr:function(e){var t=e.recipients,n=e.addRow,o=e.rowCount,a=e.rowIndex,i=e.getSortOrder,s=e.updateTotalCount,l=e.updateRow,c=e.values,u=e.setRecipientValue,d=e.translate;return{headerHtml:function(){return r.createElement(N.A,{placeholder:d("react.stockMovement.recipient.label","Recipient"),className:"select-xs my-2",classNamePrefix:"react-select",options:t,onChange:function(e){e&&u(e)}})},options:t,onTabPress:o===a+1?function(){s(1),n({sortOrder:i()})}:null,arrowRight:o===a+1?function(){s(1),n({sortOrder:i()})}:null,arrowDown:o===a+1?function(){s(1),n({sortOrder:i()})}:null,onBlur:function(){return l(c,a)}}},attributes:{labelKey:"name",openOnClick:!1}},deleteButton:Y}}},U=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),B(n=function(e,t,n){return t=F(t),function(e,t){if(t&&("object"==R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,L()?Reflect.construct(t,n||[],F(e).constructor):t.apply(e,n))}(this,t,[e]),"dataFetched",!1),n.state={currentLineItems:[],sortOrder:0,values:j(j({},n.props.initialValues),{},{lineItems:[]}),newItem:!1,totalCount:0,isFirstPageLoaded:!1},n.props.showSpinner(),n.removeItem=n.removeItem.bind(n),n.importTemplate=n.importTemplate.bind(n),n.getSortOrder=n.getSortOrder.bind(n),n.confirmSave=n.confirmSave.bind(n),n.confirmTransition=n.confirmTransition.bind(n),n.newItemAdded=n.newItemAdded.bind(n),n.validate=n.validate.bind(n),n.isValidForSave=n.isValidForSave.bind(n),n.isRowLoaded=n.isRowLoaded.bind(n),n.loadMoreRows=n.loadMoreRows.bind(n),n.updateTotalCount=n.updateTotalCount.bind(n),n.updateRow=n.updateRow.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&V(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData())}},{key:"componentWillReceiveProps",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData())}},{key:"getLineItemsToBeSaved",value:function(e){var t=this,n=v().filter(e,(function(e){return!e.statusCode&&e.quantityRequested&&"0"!==e.quantityRequested&&e.product})),r=v().filter(e,(function(e){return e.statusCode})),o=[];return v().forEach(r,(function(e){var n,r,a=v().find(t.state.currentLineItems,(function(t){return t.id===e.id})),i=parseInt(a.quantityRequested,10),s=parseInt(e.quantityRequested,10),l=a.recipient&&v().isObject(a.recipient)?a.recipient.id:a.recipient,c=e.recipient&&v().isObject(e.recipient)?e.recipient.id:e.recipient,u=v().remove(v().intersection(v().keys(a),v().keys(e)),(function(e){return"product"!==e}));v().isEqual(v().pick(e,u),v().pick(a,u))&&e.product.id===a.product.id?(s!==i||c!==l||null!==(n=e.inventoryItem)&&void 0!==n&&n.expirationDate&&e.expirationDate&&(null===(r=e.inventoryItem)||void 0===r?void 0:r.expirationDate)!==e.expirationDate)&&o.push(e):o.push(e)})),[].concat(v().map(n,(function(e){return{product:{id:e.product.id},quantityRequested:e.quantityRequested,palletName:e.palletName,boxName:e.boxName,lotNumber:e.lotNumber,expirationDate:e.expirationDate,recipient:{id:v().isObject(e.recipient)?e.recipient.id||"":e.recipient||""},sortOrder:e.sortOrder}})),v().map(o,(function(e){return{id:e.id,product:{id:e.product.id},quantityRequested:e.quantityRequested,palletName:e.palletName,boxName:e.boxName,lotNumber:e.lotNumber,expirationDate:e.expirationDate,recipient:{id:v().isObject(e.recipient)?e.recipient.id||"":e.recipient||""},sortOrder:e.sortOrder}})))}},{key:"getSortOrder",value:function(){return this.setState((function(e){return{sortOrder:e.sortOrder+100}})),this.state.sortOrder}},{key:"setLineItems",value:function(e,t){var n,r=this,o=e.data.data;n=0!==this.state.values.lineItems.length||o.length?v().map(o,(function(e){return j(j({},e),{},{disabled:!0})})):new Array(1).fill({sortOrder:100});var a=v().toInteger(v().last(n).sortOrder)+100;this.setState((function(e){return{currentLineItems:r.props.isPaginated?v().uniqBy(v().concat(e.currentLineItems,o),"id"):o,values:j(j({},e.values),{},{lineItems:r.props.isPaginated?v().uniqBy(v().concat(e.values.lineItems,n),"id"):n}),sortOrder:a}}),(function(){v().isNull(t)||r.state.values.lineItems.length===r.state.totalCount||r.loadMoreRows({startIndex:t+r.props.pageSize}),r.props.hideSpinner()}))}},{key:"updateTotalCount",value:function(e){this.setState((function(t){return{totalCount:t.totalCount+e===0?1:t.totalCount+e}}))}},{key:"updateRow",value:function(e,t){var n=e.lineItems[t];this.setState({values:d()(e,{lineItems:B({},t,{$set:n})})})}},{key:"validate",value:function(e,t){var n={lineItems:[]},r=h()(this.props.minimumExpirationDate,"MM/DD/YYYY");return v().forEach(e.lineItems,(function(e,o){n.lineItems[o]={},v().isNil(e.product)||e.quantityRequested&&!(e.quantityRequested<0)||(n.lineItems[o]={quantityRequested:"react.stockMovement.error.enterQuantity.label"}),!v().isEmpty(e.boxName)&&v().isEmpty(e.palletName)&&(n.lineItems[o]={boxName:"react.stockMovement.error.boxWithoutPallet.label"});var a=h()(e.expirationDate,"MM/DD/YYYY");r.diff(a)>0&&(n.lineItems[o]={expirationDate:"react.stockMovement.error.invalidDate.label"}),t||(e.expirationDate&&(v().isNil(e.lotNumber)||v().isEmpty(e.lotNumber))&&(n.lineItems[o]={lotNumber:"react.stockMovement.error.expiryWithoutLot.label"}),!v().isNil(e.product)&&e.product.lotAndExpiryControl&&(e.expirationDate||!v().isNil(e.lotNumber)&&!v().isEmpty(e.lotNumber)?e.expirationDate?(v().isNil(e.lotNumber)||v().isEmpty(e.lotNumber))&&(n.lineItems[o]={lotNumber:"react.stockMovement.error.lotAndExpiryControl.label"}):n.lineItems[o]={expirationDate:"react.stockMovement.error.lotAndExpiryControl.label"}:n.lineItems[o]={expirationDate:"react.stockMovement.error.lotAndExpiryControl.label",lotNumber:"react.stockMovement.error.lotAndExpiryControl.label"}))})),n}},{key:"isValidForSave",value:function(e){var t=this.validate(e,!0);return!t.lineItems||t.lineItems.every(v().isEmpty)}},{key:"newItemAdded",value:function(){this.setState({newItem:!0})}},{key:"confirmSave",value:function(e){(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmSave.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmSave.message","Are you sure you want to save? There are some lines with empty or zero quantity, those lines will be deleted."),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:e},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"confirmTransition",value:function(e,t){(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmTransition.label","You have entered the same code twice. Do you want to continue?"),message:v().map(t,(function(e){var t;return r.createElement("p",{key:e.sortOrder},"".concat(e.product.productCode," ").concat((null===(t=e.product.displayNames)||void 0===t?void 0:t.default)||e.product.name," ").concat(e.quantityRequested))})),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:e},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"confirmInventoryItemExpirationDateUpdate",value:function(e){(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmSave.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmExpiryDateUpdate.message","This will update the expiry date across all depots in the system. Are you sure you want to proceed?"),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:e},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"fetchAllData",value:function(){this.props.fetchUsers(),this.fetchAddItemsPageData(),this.props.isPaginated||this.fetchLineItems()}},{key:"fetchLineItems",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?stepNumber=2");return A.Ay.get(t).then((function(t){e.setState({totalCount:t.data.data.length},(function(){return e.setLineItems(t,null)}))})).catch((function(e){return e}))}},{key:"fetchAddItemsPageData",value:function(){var e=this;this.props.showSpinner();var t="/api/stockMovements/".concat(this.state.values.stockMovementId);A.Ay.get(t).then((function(t){var n=t.data.data.hasManageInventory,r=t.data.data.statusCode,o=t.data.totalCount;e.setState((function(e){return{values:j(j({},e.values),{},{hasManageInventory:n,statusCode:r}),totalCount:0===o?1:o}}),(function(){return e.props.hideSpinner()}))}))}},{key:"loadMoreRows",value:function(e){var t=this,n=e.startIndex;this.setState({isFirstPageLoaded:!0});var r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?offset=").concat(n,"&max=").concat(this.props.pageSize,"&stepNumber=2");A.Ay.get(r).then((function(e){t.setLineItems(e,n)}))}},{key:"nextPage",value:function(e){var t=this,n=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)&&e.product}));v().some(n,(function(e){return!e.quantityRequested||"0"===e.quantityRequested}))?this.confirmSave((function(){return t.checkDuplicatesSaveAndTransitionToNextStep(e,n)})):this.checkDuplicatesSaveAndTransitionToNextStep(e,n)}},{key:"checkDuplicatesSaveAndTransitionToNextStep",value:function(e,t){var n=this,r={};v().forEach(t,(function(e){r[e.product.productCode]?r[e.product.productCode].push(e):r[e.product.productCode]=[e]}));var o=v().filter(r,(function(e){return e.length>1}));v().some(r,(function(e){return e.length>1}))&&"SUPPLIER"!==this.state.values.origin.type&&this.state.values.hasManageInventory?this.confirmTransition((function(){return n.saveAndTransitionToNextStep(e,t)}),v().reduce(o,(function(e,t){return e.concat(t)}),[])):this.saveAndTransitionToNextStep(e,t)}},{key:"saveAndTransitionToNextStep",value:function(e,t){var n=this;this.props.showSpinner(),this.saveRequisitionItemsInCurrentStep(t).then((function(r){var o=e;r&&(o=j(j({},e),{},{lineItems:r.data.data.lineItems})),v().some(o.lineItems,(function(e){return e.inventoryItem&&e.expirationDate!==e.inventoryItem.expirationDate}))?v().some(o.lineItems,(function(e){return e.inventoryItem.quantity&&"0"!==e.inventoryItem.quantity}))?(n.props.hideSpinner(),n.confirmInventoryItemExpirationDateUpdate((function(){return n.updateInventoryItemsAndTransitionToNextStep(o,t)}))):n.updateInventoryItemsAndTransitionToNextStep(o,t):n.transitionToNextStepAndChangePage(e)})).catch((function(){return n.props.hideSpinner()}))}},{key:"updateInventoryItemsAndTransitionToNextStep",value:function(e,t){var n=this,r=this.getLineItemsToBeSaved(t),o="/api/stockMovements/".concat(this.state.values.stockMovementId,"/updateInventoryItems"),a={id:this.state.values.stockMovementId,lineItems:r};this.props.showSpinner(),A.Ay.post(o,a).then((function(){return n.transitionToNextStepAndChangePage(e)})).catch((function(){return n.props.hideSpinner()}))}},{key:"saveRequisitionItemsInCurrentStep",value:function(e){var t=this,n=this.getLineItemsToBeSaved(e),r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/updateItems"),o={id:this.state.values.stockMovementId,lineItems:n};return o.lineItems.length?A.Ay.post(r,o).then((function(e){var n=e.data.data.lineItems,r=v().map(n,(function(e){return j({},e)}));return t.setState((function(e){return{currentLineItems:r,values:j(j({},e.values),{},{lineItems:r})}})),e})).catch((function(){return Promise.reject(new Error(t.props.translate("react.stockMovement.error.saveRequisitionItems.label","Could not save requisition items")))})):Promise.resolve()}},{key:"save",value:function(e){var t=this,n=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)}));v().some(n,(function(e){return!e.quantityRequested||"0"===e.quantityRequested}))?this.confirmSave((function(){return t.saveItems(n)})):this.saveItems(n)}},{key:"saveAndExit",value:function(e){var t=this.validate(e).lineItems;t.length&&t.every((function(e){return"object"===R(e)&&v().isEmpty(e)}))?this.saveRequisitionItemsInCurrentStep(e.lineItems).then((function(){window.location=D.ti.show(e.stockMovementId)})):(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmExit.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmExit.message","Validation errors occurred. Are you sure you want to exit and lose unsaved data?"),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){window.location=D.ti.show(e.stockMovementId)}},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"saveItems",value:function(e){var t=this;this.props.showSpinner(),this.saveRequisitionItemsInCurrentStep(e).then((function(){t.props.hideSpinner(),S().success(t.props.translate("react.stockMovement.alert.saveSuccess.label","Changes saved successfully"),{timeout:3e3})})).catch((function(){return t.props.hideSpinner()}))}},{key:"refresh",value:function(){var e=this;(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmRefresh.label","Confirm refresh"),message:this.props.translate("react.stockMovement.confirmRefresh.message","Are you sure you want to refresh? Your progress since last save will be lost."),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){return e.fetchAllData()}},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"removeItem",value:function(e){var t=this,n="/api/stockMovementItems/".concat(e,"/removeItem");return A.Ay.delete(n).catch((function(){return t.props.hideSpinner(),Promise.reject(new Error("react.stockMovement.error.deleteRequisitionItem.label"))}))}},{key:"removeAll",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/removeAllItems");return A.Ay.delete(t).then((function(){e.setState((function(e){return{totalCount:1,currentLineItems:[],values:j(j({},e.values),{},{lineItems:new Array(1).fill({sortOrder:100})})}}))})).catch((function(){return e.fetchLineItems(),Promise.reject(new Error("react.stockMovement.error.deleteRequisitionItem.label"))}))}},{key:"transitionToNextStep",value:function(){var e="/api/stockMovements/".concat(this.state.values.stockMovementId,"/status");return"CREATED"===this.state.values.statusCode?A.Ay.post(e,{status:"CHECKING"}):Promise.resolve()}},{key:"transitionToNextStepAndChangePage",value:function(e){var t=this;this.transitionToNextStep().then((function(){t.props.nextPage(e)})).catch((function(){return t.props.hideSpinner()}))}},{key:"exportTemplate",value:function(e){var t=v().filter(e.lineItems,(function(e){return!v().isEmpty(e)}));this.saveItemsAndExportTemplate(e,t)}},{key:"isRowLoaded",value:function(e){var t=e.index;return!!this.state.values.lineItems[t]}},{key:"saveItemsAndExportTemplate",value:function(e,t){var n=this;this.props.showSpinner();var r=e.movementNumber,o=e.stockMovementId,a="/stockMovement/exportCsv/".concat(o);this.saveRequisitionItemsInCurrentStep(t).then((function(){A.Ay.get(a,{responseType:"blob"}).then((function(e){m()(e.data,"ItemList".concat(r?"-".concat(r):"",".csv"),"text/csv"),n.props.hideSpinner()})).catch((function(){return n.props.hideSpinner()}))}))}},{key:"importTemplate",value:function(e){var t=this;this.props.showSpinner();var n=new FormData,r=e.target.files[0],o=this.state.values.stockMovementId;n.append("importFile",r.slice(0,r.size,"text/csv"));var a="/stockMovement/importCsv/".concat(o);return A.Ay.post(a,n,{headers:{"content-type":"multipart/form-data"}}).then((function(){t.fetchLineItems(),v().isNil(v().last(t.state.values.lineItems).product)&&t.setState((function(e){return{values:j(j({},e.values),{},{lineItems:[]})}}))})).catch((function(){t.props.hideSpinner()}))}},{key:"previousPage",value:function(e,t){var n=this;t?(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmPreviousPage.label","Validation error"),message:this.props.translate("react.stockMovement.confirmPreviousPage.message.label","Cannot save due to validation error on page"),buttons:[{label:this.props.translate("react.stockMovement.confirmPreviousPage.correctError.label","Correct error")},{label:this.props.translate("react.stockMovement.confirmPreviousPage.continue.label","Continue (lose unsaved work)"),onClick:function(){return n.props.previousPage(e)}}]}):this.saveRequisitionItemsInCurrentStep(e.lineItems).then((function(){return n.props.previousPage(e)}))}},{key:"render",value:function(){var e=this;return r.createElement(g.lV,{onSubmit:function(){},validate:this.validate,mutators:j(j({},c.A),{},{setColumnValue:x.UM}),initialValues:this.state.values,render:function(t){var n=t.handleSubmit,o=t.values,a=t.invalid,i=t.form.mutators;return r.createElement("div",{className:"d-flex flex-column"},r.createElement("span",{className:"buttons-container"},r.createElement("label",{htmlFor:"csvInput",className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-download pr-2"}),r.createElement(C.A,{id:"react.default.button.importTemplate.label",defaultMessage:"Import template"})),r.createElement("input",{id:"csvInput",type:"file",style:{display:"none"},onChange:e.importTemplate,onClick:function(e){e.target.value=null},accept:".csv"})),r.createElement("button",{type:"button",onClick:function(){return e.exportTemplate(o)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-upload pr-2"}),r.createElement(C.A,{id:"react.default.button.exportTemplate.label",defaultMessage:"Export template"}))),r.createElement("button",{type:"button",onClick:function(){return e.refresh()},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-refresh pr-2"}),r.createElement(C.A,{id:"react.default.button.refresh.label",defaultMessage:"Reload"}))),r.createElement("button",{type:"button",disabled:!e.isValidForSave(o),onClick:function(){return e.save(o)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-save pr-2"}),r.createElement(C.A,{id:"react.default.button.save.label",defaultMessage:"Save"}))),r.createElement("button",{type:"button",disabled:!e.isValidForSave(o),onClick:function(){return e.saveAndExit(o)},className:"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(C.A,{id:"react.default.button.saveAndExit.label",defaultMessage:"Save and exit"}))),r.createElement("button",{type:"button",disabled:a,onClick:function(){return e.removeAll().then((function(){return e.fetchAndSetLineItems()}))},className:"float-right mb-1 btn btn-outline-danger align-self-end btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-remove pr-2"}),r.createElement(C.A,{id:"react.default.button.deleteAll.label",defaultMessage:"Delete all"})))),r.createElement("form",{onSubmit:n},r.createElement("div",{className:"table-form","data-testid":"items-table"},v().map(_,(function(t,n){return(0,x.bl)(t,n,{stocklist:o.stocklist,recipients:e.props.recipients,removeItem:e.removeItem,originId:e.state.values.origin.id,getSortOrder:e.getSortOrder,newItemAdded:e.newItemAdded,newItem:e.state.newItem,totalCount:e.state.totalCount,loadMoreRows:e.loadMoreRows,isRowLoaded:e.isRowLoaded,updateTotalCount:e.updateTotalCount,isPaginated:e.props.isPaginated,isFromOrder:e.state.values.isFromOrder,updateRow:e.updateRow,values:o,isFirstPageLoaded:e.state.isFirstPageLoaded,setRecipientValue:function(e){return i.setColumnValue("lineItems","recipient",e)},translate:e.props.translate})}))),r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"button",disabled:a,onClick:function(){return e.previousPage(o,a)},className:"btn btn-outline-primary btn-form btn-xs"},r.createElement(C.A,{id:"react.default.button.previous.label",defaultMessage:"Previous"})),r.createElement("button",{type:"submit",onClick:function(){a||e.nextPage(o)},className:"btn btn-outline-primary btn-form float-right btn-xs",disabled:!v().some(o.lineItems,(function(e){return e.product&&v().parseInt(e.quantityRequested)}))},r.createElement(C.A,{id:"react.default.button.next.label",defaultMessage:"Next"})))))}})}}])&&q(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const W=(0,s.Ng)((function(e){return{recipients:e.users.data,translate:(0,C.H)((0,i.ro)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,minimumExpirationDate:e.session.minimumExpirationDate,isPaginated:e.session.isPaginated,pageSize:e.session.pageSize}}),{showSpinner:l.xc,hideSpinner:l.W$,fetchUsers:l.hU})(U);U.propTypes={initialValues:a().shape({origin:a().shape({id:a().string}),hasManageInventory:a().bool}).isRequired,previousPage:a().func.isRequired,nextPage:a().func.isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,fetchUsers:a().func.isRequired,recipients:a().arrayOf(a().shape({})).isRequired,translate:a().func.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,minimumExpirationDate:a().string.isRequired,isPaginated:a().bool.isRequired,pageSize:a().number.isRequired};var H=n(84976),Z=n(24178);function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Q(e,t,n){return(t=J(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,J(r.key),r)}}function J(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}function ee(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ee=function(){return!!e})()}function te(e){return te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},te(e)}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}function re(e){var t={};if(e.description||(t.description="react.default.error.requiredField.label"),e.origin||(t.origin="react.default.error.requiredField.label"),e.destination||(t.destination="react.default.error.requiredField.label"),e.requestedBy||(t.requestedBy="react.default.error.requiredField.label"),e.dateRequested){var n=h()(e.dateRequested,"MM/DD/YYYY");h()().diff(n)<0&&(t.dateRequested="react.stockMovement.error.futureDate.label")}else t.dateRequested="react.default.error.requiredField.label";return t}var oe={description:{type:P.A,label:"react.stockMovement.description.label",defaultMessage:"Description",attributes:{required:!0,autoFocus:!0}},origin:{type:I.A,label:"react.stockMovement.origin.label",defaultMessage:"Origin",attributes:{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedLocationsFetch,onChange:function(t){t&&e.destination&&e.destination.id&&e.fetchStockLists(t,e.destination)}}}},destination:{type:I.A,label:"react.stockMovement.destination.label",defaultMessage:"Destination",attributes:{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedLocationsFetch,onChange:function(t){t&&e.origin&&e.origin.id&&e.fetchStockLists(e.origin,t)},disabled:!e.isSuperuser}}},stocklist:{label:"react.stockMovement.stocklist.label",defaultMessage:"Stocklist",type:I.A,getDynamicAttr:function(e){var t=e.origin,n=e.destination,r=e.stocklists;return{disabled:!(t&&n&&t.id&&n.id),options:r,showValueTooltip:!0,valueKey:"id",labelKey:"name"}}},requestedBy:{type:I.A,label:"react.stockMovement.requestedBy.label",defaultMessage:"Requested by",attributes:{async:!0,required:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],labelKey:"name",filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedPeopleFetch}}},dateRequested:{type:O.A,label:"react.stockMovement.dateRequested.label",defaultMessage:"Date requested",attributes:{required:!0,localizeDate:!0,autoComplete:"off"}}},ae=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=te(t),function(e,t){if(t&&("object"==K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ee()?Reflect.construct(t,n||[],te(e).constructor):t.apply(e,n))}(this,t,[e])).state={stocklists:[],setInitialValues:!0,values:n.props.initialValues},n.fetchStockLists=n.fetchStockLists.bind(n),n.debouncedPeopleFetch=(0,Z.tF)(n.props.debounceTime,n.props.minSearchLength),n.debouncedLocationsFetch=(0,Z.Uq)(n.props.debounceTime,n.props.minSearchLength),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.state.values.origin&&this.state.values.destination&&this.fetchStockLists(this.state.values.origin,this.state.values.destination)}},{key:"componentWillReceiveProps",value:function(e){!this.props.match.params.stockMovementId&&this.state.setInitialValues&&e.location.id&&this.setInitialValues(e.location)}},{key:"setInitialValues",value:function(e){var t=e.id,n=e.locationType,r=e.name,o={destination:{id:t,type:n?n.locationTypeCode:null,name:r,label:"".concat(r," [").concat(n?n.description:null,"]")}};this.setState({values:o,setInitialValues:!1})}},{key:"checkStockMovementChange",value:function(e){var t=this.props.initialValues,n=t.origin,r=t.destination,o=t.stocklist,a=e.origin&&n,i=n&&"SUPPLIER"===n.type,s=e.origin&&"SUPPLIER"===e.type,l=!(!a||i&&(!i||s))&&e.origin.id!==n.id,c=!!(o&&e.destination&&r)&&e.destination.id!==r.id,u=!!e.stockMovementId&&v().get(e.stocklist,"id",null)!==v().get(o,"id",null);return l||c||u}},{key:"fetchStockLists",value:function(e,t,n){var r=this;this.props.showSpinner();var o="/api/stocklists?origin=".concat(e.id,"&destination=").concat(t.id);return A.Ay.get(o).then((function(e){var t=v().map(e.data.data,(function(e){return{id:e.id,name:e.name,value:e.id,label:e.name}}));!v().find(t,(function(e){return e.value.id===v().get(r.state.values,"stocklist.id")}))&&n&&n(),r.setState({stocklists:t},(function(){return r.props.hideSpinner()}))})).catch((function(){return r.props.hideSpinner()}))}},{key:"saveStockMovement",value:function(e){var t=this;if(e.origin&&e.destination&&e.requestedBy&&e.dateRequested&&e.description){this.props.showSpinner();var n;n=e.stockMovementId?"/api/stockMovements/".concat(e.stockMovementId,"/updateRequisition"):"/api/stockMovements";var r={name:"",description:e.description,dateRequested:e.dateRequested,origin:{id:e.origin.id},destination:{id:e.destination.id},requestedBy:{id:e.requestedBy.id},stocklist:{id:v().get(e.stocklist,"id")||""}};A.Ay.post(n,r).then((function(n){if(n.data){var r=n.data.data;t.props.history.push(D.ti.editInbound(r.id)),t.props.nextPage($($({},e),{},{stockMovementId:r.id,lineItems:r.lineItems,movementNumber:r.identifier,name:r.name,stocklist:r.stocklist}))}})).catch((function(){return t.props.hideSpinner(),Promise.reject(new Error(t.props.translate("react.stockMovement.error.createStockMovement.label","Could not create stock movement")))}))}}},{key:"resetToInitialValues",value:function(){var e=this;this.setState({values:{}},(function(){return e.setState({values:e.props.initialValues})}))}},{key:"nextPage",value:function(e){var t=this;this.checkStockMovementChange(e)?(0,y.ZX)({title:this.props.translate("react.stockMovement.message.confirmChange.label","Confirm change"),message:this.props.translate("react.stockMovement.confirmChange.message","Do you want to change stock movement data? Changing origin, destination or stock list can cause loss of your current work"),buttons:[{label:this.props.translate("react.default.no.label","No"),onClick:function(){return t.resetToInitialValues()}},{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){return t.saveStockMovement(e)}}]}):this.saveStockMovement(e)}},{key:"render",value:function(){var e=this;return r.createElement(g.lV,{onSubmit:function(t){return e.nextPage(t)},validate:re,initialValues:this.state.values,mutators:{clearStocklist:function(e,t,n){n.changeValue(t,"stocklist",(function(){return null}))}},render:function(t){var n=t.form.mutators,o=t.handleSubmit,a=t.values;return r.createElement("form",{onSubmit:o},r.createElement("div",{className:"classic-form with-description"},v().map(oe,(function(t,r){return(0,x.bl)(t,r,{stocklists:e.state.stocklists,fetchStockLists:function(t,r){return e.fetchStockLists(t,r,n.clearStocklist)},origin:a.origin,destination:a.destination,isSuperuser:e.props.isSuperuser,debouncedPeopleFetch:e.debouncedPeopleFetch,debouncedLocationsFetch:e.debouncedLocationsFetch})}))),r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"submit",className:"btn btn-outline-primary float-right btn-xs"},r.createElement(C.A,{id:"react.default.button.next.label",defaultMessage:"Next"}))))}})}}])&&G(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const ie=(0,H.withRouter)((0,s.Ng)((function(e){return{location:e.session.currentLocation,isSuperuser:e.session.isSuperuser,translate:(0,C.H)((0,i.ro)(e.localize)),debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength,user:e.session.user}}),{showSpinner:l.xc,hideSpinner:l.W$})(ae));ae.propTypes={match:a().shape({params:a().shape({stockMovementId:a().string})}).isRequired,initialValues:a().shape({origin:a().shape({id:a().string}),destination:a().shape({id:a().string}),stocklist:a().shape({})}).isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,nextPage:a().func.isRequired,history:a().shape({push:a().func}).isRequired,location:a().shape({name:a().string,id:a().string,locationType:a().shape({description:a().string,locationTypeCode:a().string})}).isRequired,isSuperuser:a().bool.isRequired,translate:a().func.isRequired,debounceTime:a().number.isRequired,minSearchLength:a().number.isRequired};var se=n(26386),le=n(90524),ce=n(45814),ue=n(39802),de=n(44323),pe=n(91019);function me(e){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(e)}function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fe.apply(null,arguments)}function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){we(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Me(r.key),r)}}function ge(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(ge=function(){return!!e})()}function ke(e){return ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ke(e)}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function we(e,t,n){return(t=Me(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Me(e){var t=function(e){if("object"!=me(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==me(t)?t:t+""}var Oe={"origin.name":{label:"react.stockMovement.origin.label",defaultMessage:"Origin",type:function(e){return r.createElement(P.A,e)},attributes:{disabled:!0}},destination:{label:"react.stockMovement.destination.label",defaultMessage:"Destination",fieldKey:"",type:function(e){return e.canBeEdited&&!e.hasStockList?r.createElement(I.A,e):null},getDynamicAttr:function(e){var t=e.canBeEdited,n=e.hasStockList,r=e.debouncedLocationsFetch;return t&&!n?{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,loadOptions:r,cache:!1,options:[],filterOptions:function(e){return e}}:{formatValue:function(e){return v().get(e,"name")}}}},"destination.name":{label:"react.stockMovement.destination.label",defaultMessage:"Destination",type:function(e){return e.canBeEdited&&!e.hasStockList?null:r.createElement(P.A,e)},getDynamicAttr:function(e){var t=e.canBeEdited,n=e.hasStockList;return{disabled:!t||n}}},dateShipped:{type:O.A,label:"react.stockMovement.shipDate.label",defaultMessage:"Shipment date",attributes:{localizeDate:!0,localizedDateFormat:ue.A.DEFAULT,dateFormat:"MM/DD/YYYY HH:mm Z",required:!0,showTimeSelect:!0,autoComplete:"off",showError:!0},getDynamicAttr:function(e){var t=e.issued,n=e.showOnly;return{disabled:t||n}}},shipmentType:{type:I.A,label:"react.stockMovement.shipmentType.label",defaultMessage:"Shipment type",attributes:{required:!0,showValueTooltip:!0,valueKey:"id",labelKey:"name"},getDynamicAttr:function(e){var t=e.shipmentTypes,n=e.received;return{options:t,disabled:e.showOnly||n}}},trackingNumber:{type:P.A,label:"react.stockMovement.trackingNumber.label",defaultMessage:"Tracking number",getDynamicAttr:function(e){var t=e.received;return{disabled:e.showOnly||t}}},driverName:{type:P.A,label:"react.stockMovement.driverName.label",defaultMessage:"Driver name",getDynamicAttr:function(e){var t=e.received;return{disabled:e.showOnly||t}}},comments:{type:P.A,label:"react.stockMovement.comments.label",defaultMessage:"Comments",getDynamicAttr:function(e){var t=e.received;return{disabled:e.showOnly||t}}},expectedDeliveryDate:{type:O.A,label:"react.stockMovement.expectedDeliveryDate.label",defaultMessage:"Expected receipt date",attributes:{localizeDate:!0,required:!0,showTimeSelect:!1,autoComplete:"off"}}},Ee={tableItems:{type:w.A,virtualized:!0,totalCount:function(e){return e.totalCount},isRowLoaded:function(e){return e.isRowLoaded},loadMoreRows:function(e){return(0,e.loadMoreRows)()},isFirstPageLoaded:function(e){return e.isFirstPageLoaded},fields:{palletName:{type:ce.A,label:"react.stockMovement.packLevel1.label",defaultMessage:"Pack level 1",getDynamicAttr:function(e){return{hide:e.isPalletNameEmpty}}},boxName:{type:ce.A,label:"react.stockMovement.packLevel2.label",defaultMessage:"Pack level 2",getDynamicAttr:function(e){return{hide:e.isBoxNameEmpty}}},productCode:{type:ce.A,label:"react.stockMovement.code.label",defaultMessage:"Code"},product:{type:ce.A,label:"react.stockMovement.product.label",defaultMessage:"Product",headerAlign:"left",getDynamicAttr:function(e){var t,n=e.fieldValue;return{flexWidth:12+(e.isBoxNameEmpty?12:0)+(e.isPalletNameEmpty?12:0),showValueTooltip:!(null==n||null===(t=n.displayNames)||void 0===t||!t.default),tooltipValue:null==n?void 0:n.name}},attributes:{className:"text-left",formatValue:de.OL}},lotNumber:{type:ce.A,label:"react.stockMovement.lot.label",defaultMessage:"Lot"},expirationDate:{type:ce.A,label:"react.stockMovement.expiry.label",defaultMessage:"Expiry",getDynamicAttr:function(e){var t=e.formatLocalizedDate;return{formatValue:function(e){return t(e,ue.A.COMMON)}}}},quantityRequested:{type:ce.A,fixedWidth:"150px",label:"react.stockMovement.quantityPicked.label",defaultMessage:"Qty Picked"},"recipient.name":{type:ce.A,label:"react.stockMovement.recipient.label",defaultMessage:"Recipient"}}}},Ie=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),we(n=function(e,t,n){return t=ke(t),function(e,t){if(t&&("object"==me(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,ge()?Reflect.construct(t,n||[],ke(e).constructor):t.apply(e,n))}(this,t,[e]),"dataFetched",!1),n.state={shipmentTypes:[],documents:[],files:[],values:he(he({},n.props.initialValues),{},{tableItems:[]}),totalCount:0,isFirstPageLoaded:!1},n.props.showSpinner(),n.onDrop=n.onDrop.bind(n),n.isRowLoaded=n.isRowLoaded.bind(n),n.loadMoreRows=n.loadMoreRows.bind(n),n.toggleDropdown=n.toggleDropdown.bind(n),n.validate=n.validate.bind(n),n.debouncedLocationsFetch=(0,Z.Uq)(n.props.debounceTime,n.props.minSearchLength),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.props.showSpinner(),this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchStockMovementData())}},{key:"componentWillReceiveProps",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchStockMovementData())}},{key:"onDrop",value:function(e){var t=this.state.files,n=v().differenceBy(t,e,"name");this.setState({files:v().concat(n,e)})}},{key:"onSave",value:function(e){var t=this;this.props.showSpinner(),this.saveValues(e).then((function(){t.props.hideSpinner(),"DISPATCHED"===e.statusCode&&t.fetchStockMovementData(),S().success(t.props.translate("react.stockMovement.alert.saveSuccess.label","Changes saved successfully"),{timeout:3e3})})).catch((function(){return t.props.hideSpinner()}))}},{key:"saveValues",value:function(e){var t={destination:{id:e.destination.id},dateShipped:e.dateShipped,shipmentType:e.shipmentType.id,trackingNumber:e.trackingNumber||"",driverName:e.driverName||"",comments:e.comments||"",expectedDeliveryDate:e.expectedDeliveryDate||""};return this.saveShipment(t)}},{key:"removeFile",value:function(e){var t=this.state.files;v().remove(t,(function(t){return t.name===e})),this.setState({files:t})}},{key:"removeFiles",value:function(e){var t=this.state.files;v().forEach(e,(function(e){v().remove(t,(function(t){return t.name===e}))})),this.setState({files:t})}},{key:"fetchShipmentTypes",value:function(){var e=this;return A.Ay.get("/api/generic/shipmentType").then((function(t){var n=v().map(t.data.data,(function(t){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],l=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ve(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(v().split(t.name,"|fr:"),2),r=n[0],o=n[1];return he(he({},t),{},{label:"fr"===e.props.locale&&o?o:r})}));e.setState({shipmentTypes:n},(function(){return e.props.hideSpinner()}))})).catch((function(){return e.props.hideSpinner()}))}},{key:"fetchStockMovementItems",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?stepNumber=6");A.Ay.get(t).then((function(t){var n=t.data.data;e.setState((function(e){return{values:he(he({},e.values),{},{tableItems:n})}}))}))}},{key:"loadMoreRows",value:function(e){var t=this,n=e.startIndex;if(this.state.totalCount){var r="/api/stockMovements/".concat(this.state.values.stockMovementId,"/stockMovementItems?offset=").concat(n,"&max=").concat(this.props.pageSize,"&stepNumber=6");A.Ay.get(r).then((function(e){var r=e.data.data,o=v().map(r,(function(e){return he(he({},e),{},{productName:e.productName?e.productName:e.product.name})})),a=v().find(o,"id")?"id":"shipmentItemId";t.setState((function(e){return{values:he(he({},e.values),{},{tableItems:v().uniqBy(v().concat(e.values.tableItems,o),a)}),isFirstPageLoaded:!0}}),(function(){t.state.values.tableItems.length!==t.state.totalCount&&t.loadMoreRows({startIndex:n+t.props.pageSize})}))}))}}},{key:"isRowLoaded",value:function(e){var t=e.index;return!!this.state.values.tableItems[t]}},{key:"fetchStockMovementData",value:function(){var e=this,t="/api/stockMovements/".concat(this.state.values.stockMovementId,"?stepNumber=6");return A.Ay.get(t).then((function(t){var n=t.data.data,r=t.data.data.associations,o=t.data.totalCount,a=v().filter(r.documents,(function(e){return 5===e.stepNumber})),i=n.destination.locationType;e.setState((function(t){return{documents:a,totalCount:o,values:he(he({},t.values),{},{dateShipped:n.dateShipped,shipmentType:he(he({},n.shipmentType),{},{label:(0,pe.Ay)(n.shipmentType.name,e.props.locale)}),trackingNumber:n.trackingNumber,driverName:n.driverName,comments:n.comments,expectedDeliveryDate:n.expectedDeliveryDate,name:n.name,description:n.description,destination:{id:n.destination.id,type:i?i.locationTypeCode:null,name:n.destination.name,label:"".concat(n.destination.name,"\n                [").concat(i?i.description:null,"]")}})}}),(function(){e.props.nextPage(e.state.values),e.fetchShipmentTypes(),e.props.isPaginated||e.fetchStockMovementItems()}))})).catch((function(){return e.props.hideSpinner()}))}},{key:"sendFile",value:function(e){var t="/stockMovement/uploadDocument/".concat(this.state.values.stockMovementId),n=new FormData;return n.append("fileContents",e),A.Ay.post(t,n)}},{key:"sendFiles",value:function(e){var t="/stockMovement/uploadDocuments/".concat(this.state.values.stockMovementId),n=new FormData;return v().forEach(e,(function(e,t){n.append("filesContents[".concat(t,"]"),e)})),A.Ay.post(t,n)}},{key:"saveShipment",value:function(e){var t="/api/stockMovements/".concat(this.state.values.stockMovementId,"/updateShipment");return A.Ay.post(t,e)}},{key:"stateTransitionToSent",value:function(){var e="/api/stockMovements/".concat(this.state.values.stockMovementId,"/status");return A.Ay.post(e,{status:"DISPATCHED"})}},{key:"sendFilesAndSave",value:function(e){var t=this,n=this.validate(e);if(v().isEmpty(n)){this.props.showSpinner();var r=this.state.files;r.length>1?this.sendFiles(r).then((function(){S().success(t.props.translate("react.stockMovement.alert.filesSuccess.label","Files uploaded successfuly!"),{timeout:3e3}),t.removeFiles(v().map(r,(function(e){return e.name}))),t.prepareRequestAndSubmitStockMovement(e)})).catch((function(){return S().error(t.props.translate("react.stockMovement.alert.filesError.label","Error occured during files upload!"))})).finally((function(){return t.props.hideSpinner()})):1===r.length?this.sendFile(r[0]).then((function(){S().success(t.props.translate("react.stockMovement.alert.fileSuccess.label","File uploaded successfuly!"),{timeout:3e3}),t.removeFile(r[0].name),t.prepareRequestAndSubmitStockMovement(e)})).catch((function(){return S().error(t.props.translate("react.stockMovement.alert.fileError.label","Error occured during file upload!"))})).finally((function(){return t.props.hideSpinner()})):this.prepareRequestAndSubmitStockMovement(e)}}},{key:"prepareRequestAndSubmitStockMovement",value:function(e){var t=this,n={dateShipped:e.dateShipped,shipmentType:e.shipmentType.id,trackingNumber:e.trackingNumber||"",driverName:e.driverName||"",comments:e.comments||"",expectedDeliveryDate:e.expectedDeliveryDate||""};this.props.currentLocationId!==e.origin.id&&"SUPPLIER"!==e.origin.type&&e.hasManageInventory?(S().error(this.props.translate("react.stockMovement.alert.sendStockMovement.label","You are not able to send shipment from a location other than origin. Change your current location.")),this.props.hideSpinner()):e.shipmentType.id===v().find(this.state.shipmentTypes,(function(e){return"Default"===e.label})).id?(S().error(this.props.translate("react.stockMovement.alert.populateShipmentType.label","Please populate shipment type before continuing")),this.props.hideSpinner()):this.saveShipment(n).then((function(){t.stateTransitionToSent().then((function(){window.location=D.ti.show(t.state.values.stockMovementId)})).catch((function(){return t.props.hideSpinner()}))})).catch((function(){return t.props.hideSpinner()}))}},{key:"previousPage",value:function(e,t){var n=this;t?(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmPreviousPage.label","Validation error"),message:this.props.translate("react.stockMovement.confirmPreviousPage.message.label","Cannot save due to validation error on page"),buttons:[{label:this.props.translate("react.stockMovement.confirmPreviousPage.correctError.label","Correct error")},{label:this.props.translate("react.stockMovement.confirmPreviousPage.continue.label","Continue (lose unsaved work)"),onClick:function(){return n.props.previousPage(e)}}]}):this.saveValues(e).then((function(){return n.props.previousPage(e)}))}},{key:"saveAndExit",value:function(e){var t=this.validate(e);v().isEmpty(t)?this.saveValues(e).then((function(){window.location=D.ti.show(e.stockMovementId)})):(0,y.ZX)({title:this.props.translate("react.stockMovement.confirmExit.label","Confirm save"),message:this.props.translate("react.stockMovement.confirmExit.message","Validation errors occurred. Are you sure you want to exit and lose unsaved data?"),buttons:[{label:this.props.translate("react.default.yes.label","Yes"),onClick:function(){window.location=D.ti.show(e.stockMovementId)}},{label:this.props.translate("react.default.no.label","No")}]})}},{key:"rollbackStockMovement",value:function(e){var t=this;this.props.showSpinner();var n="/api/stockMovements/".concat(this.state.values.stockMovementId,"/status"),r=this.props.currentLocationId===e.origin.id,o=this.props.currentLocationId===e.destination.id;e.hasManageInventory&&r||!e.hasManageInventory&&o?A.Ay.post(n,{rollback:!0}).then((function(){t.props.hideSpinner(),window.location.reload()})):(this.props.hideSpinner(),S().error(this.props.translate("react.stockMovement.alert.rollbackShipment.label","You are not able to rollback shipment from your location.")))}},{key:"toggleDropdown",value:function(){var e=this.state.isDropdownVisible;this.setState({isDropdownVisible:!e})}},{key:"validate",value:function(e){var t={},n=h()(this.props.minimumExpirationDate,"MM/DD/YYYY"),r=h()(e.dateShipped,"MM/DD/YYYY"),o=h()(e.expectedDeliveryDate,"MM/DD/YYYY");return n.diff(r)>0&&(t.dateShipped="react.stockMovement.error.invalidDate.label"),e.dateShipped||(t.dateShipped="react.default.error.requiredField.label"),e.shipmentType||(t.shipmentType="react.default.error.requiredField.label"),e.expectedDeliveryDate||(t.expectedDeliveryDate="react.default.error.requiredField.label"),h()(r).diff(o)>0&&(t.expectedDeliveryDate="react.stockMovement.error.deliveryDateBeforeShipDate.label",t.dateShipped="react.stockMovement.error.deliveryDateBeforeShipDate.label"),t}},{key:"render",value:function(){var e=this;return r.createElement("div",null,r.createElement(g.lV,{onSubmit:function(){},validate:this.validate,mutators:he({},c.A),initialValues:this.state.values,render:function(t){var n=t.handleSubmit,o=t.values,a=t.invalid;return r.createElement("form",{onSubmit:n},r.createElement("div",{className:"classic-form classic-form-condensed"},r.createElement("span",{className:"buttons-container classic-form-buttons"},r.createElement("div",{className:"dropzone float-right mb-1 btn btn-outline-secondary ".concat("DISPATCHED"===o.statusCode?"disabled":""," align-self-end btn-xs mr-1")},r.createElement(se.Ay,{disabled:"DISPATCHED"===o.statusCode,onDrop:e.onDrop,multiple:!0},(function(t){var n=t.getRootProps,o=t.getInputProps;return r.createElement("div",n(),r.createElement("input",o()),r.createElement("span",null,r.createElement("i",{className:"fa fa-upload pr-2"}),r.createElement(C.A,{id:"react.stockMovement.uploadDocuments.label",defaultMessage:"Upload Documents"})),v().map(e.state.files,(function(t){return r.createElement("div",{key:t.name,className:"chosen-file d-flex justify-content-center align-items-center"},r.createElement("div",{className:"text-truncate"},t.name),r.createElement("a",{href:"#",className:"remove-button",onClick:function(n){e.removeFile(t.name),n.stopPropagation()}},r.createElement("span",{className:"fa fa-remove"})))})))}))),r.createElement("div",{className:"dropdown"},r.createElement("button",{type:"button",onClick:e.toggleDropdown,className:"dropdown-button float-right mb-1 btn btn-outline-secondary align-self-end btn-xs mr-1"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(C.A,{id:"react.default.button.download.label",defaultMessage:"Download"}))),r.createElement("div",{className:"dropdown-content print-buttons-container col-md-3 flex-grow-1 \n                      ".concat(e.state.isDropdownVisible?"visible":"")},e.state.documents.length&&v().map(e.state.documents,(function(t,n){return t.hidden?null:r.createElement(le.A,fe({link:t.uri,buttonTitle:t.name},t,{key:n,onClick:function(){return e.saveValues(o)},disabled:!1}))})))),r.createElement("span",null,r.createElement("button",{type:"button",onClick:function(){return e.onSave(o)},className:"btn btn-outline-secondary float-right btn-form btn-xs ml-1",disabled:a},r.createElement("span",null,r.createElement("i",{className:"fa fa-save pr-2"}),r.createElement(C.A,{id:"react.default.button.save.label",defaultMessage:"Save"}))),r.createElement("button",{type:"button",onClick:function(){return e.saveAndExit(o)},className:"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs"},r.createElement("span",null,r.createElement("i",{className:"fa fa-sign-out pr-2"}),r.createElement(C.A,{id:"react.default.button.saveAndExit.label",defaultMessage:"Save and exit"}))))),r.createElement("div",{className:"form-title"},r.createElement(C.A,{id:"react.attribute.options.label",defaultMessage:"Sending options"})),v().map(Oe,(function(t,n){return(0,x.bl)(t,n,{shipmentTypes:e.state.shipmentTypes,issued:"DISPATCHED"===o.statusCode,received:o.received,canBeEdited:!o.received,debouncedLocationsFetch:e.debouncedLocationsFetch})}))),r.createElement("div",null,r.createElement("div",{className:"submit-buttons"},r.createElement("button",{type:"submit",className:"btn btn-outline-primary btn-form btn-xs",disabled:"DISPATCHED"===o.statusCode,onClick:function(){return e.previousPage(o,a)}},r.createElement(C.A,{id:"react.default.button.previous.label",defaultMessage:"Previous"})),r.createElement("button",{type:"submit",onClick:function(){e.sendFilesAndSave(o)},className:"".concat(o.shipped?"btn btn-outline-secondary":"btn btn-outline-success"," float-right btn-form btn-xs"),disabled:"DISPATCHED"===o.statusCode},r.createElement(C.A,{id:"react.stockMovement.sendShipment.label",defaultMessage:"Send shipment"})),o.shipped&&e.props.isUserAdmin?r.createElement("button",{type:"submit",onClick:function(){e.rollbackStockMovement(o)},className:"btn btn-outline-success float-right btn-xs",disabled:a||!("DISPATCHED"===o.statusCode)},r.createElement("span",null,r.createElement("i",{className:"fa fa-undo pr-2"}),r.createElement(C.A,{id:"react.default.button.rollback.label",defaultMessage:"Rollback"}))):null),r.createElement("div",{className:"my-2 table-form","data-testid":"items-table"},v().map(Ee,(function(t,n){return(0,x.bl)(t,n,{hasBinLocationSupport:e.props.hasBinLocationSupport,totalCount:e.state.totalCount,loadMoreRows:e.loadMoreRows,isRowLoaded:e.isRowLoaded,formatLocalizedDate:e.props.formatLocalizedDate,isPaginated:e.props.isPaginated,isFirstPageLoaded:e.state.isFirstPageLoaded,isBoxNameEmpty:v().every(e.state.values.tableItems,(function(e){return!e.boxName})),isPalletNameEmpty:v().every(e.state.values.tableItems,(function(e){return!e.palletName}))})})))))}}))}}])&&ye(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const Pe=(0,s.Ng)((function(e){return{translate:(0,C.H)((0,i.ro)(e.localize)),currentLocationId:e.session.currentLocation.id,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength,locale:e.session.activeLanguage,isUserAdmin:e.session.isUserAdmin,hasBinLocationSupport:e.session.currentLocation.hasBinLocationSupport,isPaginated:e.session.isPaginated,pageSize:e.session.pageSize,minimumExpirationDate:e.session.minimumExpirationDate,formatLocalizedDate:(0,pe.Yq)(e.localize)}}),{showSpinner:l.xc,hideSpinner:l.W$})(Ie);Ie.propTypes={initialValues:a().shape({}).isRequired,previousPage:a().func.isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,nextPage:a().func.isRequired,translate:a().func.isRequired,currentLocationId:a().string.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,debounceTime:a().number.isRequired,minSearchLength:a().number.isRequired,locale:a().string.isRequired,isUserAdmin:a().bool.isRequired,hasBinLocationSupport:a().bool.isRequired,isPaginated:a().bool.isRequired,pageSize:a().number.isRequired,minimumExpirationDate:a().string.isRequired,formatLocalizedDate:a().func.isRequired};var De=n(80461);function Ae(e){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ae(e)}function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){qe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Le(r.key),r)}}function Re(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Re=function(){return!!e})()}function Te(e){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Te(e)}function je(e,t){return je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},je(e,t)}function qe(e,t,n){return(t=Le(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Le(e){var t=function(e){if("object"!=Ae(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ae(t)?t:t+""}var Fe=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),qe(n=function(e,t,n){return t=Te(t),function(e,t){if(t&&("object"==Ae(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Re()?Reflect.construct(t,n||[],Te(e).constructor):t.apply(e,n))}(this,t,[e]),"pageList",[ie,W,Pe]),qe(n,"dataFetched",!1),n.state={values:n.props.initialValues,currentPage:1},n.updateWizardValues=n.updateWizardValues.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&je(e,t)}(t,e),n=t,(o=[{key:"componentDidMount",value:function(){this.props.fetchTranslations("","stockMovement"),this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:"componentWillReceiveProps",value:function(e){this.props.locale&&this.props.locale!==e.locale&&this.props.fetchTranslations(e.locale,"stockMovement"),e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:"wizardTitle",get:function(){var e=this.state.values;return e.movementNumber||e.trackingNumber?[{text:this.props.translate("react.stockMovement.label","Stock Movement"),color:"#000000",delimeter:" | "},{text:e.movementNumber,color:"#000000",delimeter:" - "},{text:e.origin.name,color:"#004d40",delimeter:" to "},{text:e.destination.name,color:"#01579b",delimeter:", "},{text:this.props.formatLocalizedDate(e.dateRequested,ue.A.COMMON),color:"#4a148c",delimeter:", "},{text:e.description,color:"#770838",delimeter:""}]:[]}},{key:"additionalWizardTitle",get:function(){var e=this.state,t=e.currentPage,n=e.values,o=n.shipped?"SHIPPED":"",a=n.received?"RECEIVED":"";return 3===t?r.createElement("span",{className:"shipment-status float-right"},"".concat(o||a||"PENDING")):null}},{key:"stepList",get:function(){return[this.props.translate("react.stockMovement.create.label","Create"),this.props.translate("react.stockMovement.addItems.label","Add items"),this.props.translate("react.stockMovement.send.label","Send")]}},{key:"updateWizardValues",value:function(e,t){this.setState({currentPage:e,values:t})}},{key:"fetchInitialValues",value:function(){var e=this;if(this.props.match.params.stockMovementId){this.props.showSpinner();var t="/api/stockMovements/".concat(this.props.match.params.stockMovementId);A.Ay.get(t).then((function(t){var n=t.data.data,r=n.origin.locationType,o=n.destination.locationType,a=Ne(Ne({},n),{},{stockMovementId:n.id,movementNumber:n.identifier,origin:{id:n.origin.id,type:r?r.locationTypeCode:null,name:n.origin.name,label:"".concat(n.origin.name," [").concat(r?r.description:null,"]")},destination:{id:n.destination.id,type:o?o.locationTypeCode:null,name:n.destination.name,label:"".concat(n.destination.name," [").concat(o?o.description:null,"]")},requestedBy:{id:n.requestedBy.id,name:n.requestedBy.name,label:n.requestedBy.name}}),i=1;switch(a.statusCode){case"NEW":break;case"CREATED":case"REQUESTING":i=2;break;default:i=3}e.setState({values:a,currentPage:i})})).catch((function(){return e.props.hideSpinner()}))}}},{key:"render",value:function(){var e=this.state,t=e.values,n=e.currentPage;return r.createElement(De.A,{pageList:this.pageList,stepList:this.stepList,initialValues:t,title:this.wizardTitle,additionalTitle:this.additionalWizardTitle,currentPage:n,prevPage:1===n?1:n-1,updateWizardValues:this.updateWizardValues})}}])&&Ce(n.prototype,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o}(r.Component);const Ve=(0,s.Ng)((function(e){return{locale:e.session.activeLanguage,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,translate:(0,C.H)((0,i.ro)(e.localize)),formatLocalizedDate:(0,pe.Yq)(e.localize)}}),{showSpinner:l.xc,hideSpinner:l.W$,fetchTranslations:l.dj})(Fe);Fe.propTypes={match:a().shape({params:a().shape({stockMovementId:a().string})}).isRequired,showSpinner:a().func.isRequired,hideSpinner:a().func.isRequired,initialValues:a().shape({shipmentStatus:a().string}),locale:a().string.isRequired,stockMovementTranslationsFetched:a().bool.isRequired,fetchTranslations:a().func.isRequired,translate:a().func.isRequired,formatLocalizedDate:a().func.isRequired},Fe.defaultProps={initialValues:{}}},33095:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(96540),o=n(4395),a=n(13077),i=["className"];function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(null,arguments)}const l=function(e){return r.createElement(o.A,s({},e,{renderInput:function(e){var t=e.className,n=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(e,i);return r.createElement(a.A,s({},n,{name:n.id,className:"select-xs ".concat(t||""),classNamePrefix:"react-select"}))}}))}},44323:(e,t,n)=>{n.d(t,{Eh:()=>v,FN:()=>S,OL:()=>h,SH:()=>b,aA:()=>k,ut:()=>g,vk:()=>y,xc:()=>w});var r=n(96540),o=n(2543),a=n.n(o),i=n(51836),s=n(33152),l=n(70317),c=n(88024);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return(t=function(e){var t=function(e){if("object"!=u(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==u(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){var t,n;return null!=e&&e.orderAdjustment||null!=e&&e.isAdjustment||null==e||null===(t=e.displayNames)||void 0===t||!t.default?null==e?void 0:e.description:r.createElement(i.Tooltip,{html:null==e?void 0:e.productName,theme:"transparent",delay:"150",duration:"250",hideDelay:"50"},null===(n=e.displayNames)||void 0===n?void 0:n.default)},b=function(e){return null!=e&&e.name?"(source: ".concat(null==e?void 0:e.name,")"):null},h=function(e){var t;return r.createElement("div",{className:"d-flex"},r.createElement("span",{className:"text-truncate"},(null==e?void 0:e.displayName)||(null==e||null===(t=e.displayNames)||void 0===t?void 0:t.default)||(null==e?void 0:e.name)),(0,c.A)(null==e?void 0:e.handlingIcons))},y=function(e){return a().map(e.containers,(function(e){return m(m({},e),{},{shipmentItems:a().map(e.shipmentItems,(function(e){return a().get(e,"recipient.id")?a().omit(e,"product.displayNames"):a().omit(m(m({},e),{},{recipient:""}),"product.displayNames")}))})}))},g=function(e){var t,n,r,o=e.product,a=e.filterValue,i=o.productCode,s=o.name,l=o.displayNames,c=null==a?void 0:a.toLowerCase();return(null==i||null===(t=i.toLowerCase())||void 0===t?void 0:t.includes(c))||(null==s||null===(n=s.toLowerCase())||void 0===n?void 0:n.includes(c))||(null==l||null===(r=l.default)||void 0===r||null===(r=r.toLowerCase())||void 0===r?void 0:r.includes(c))},k=function(e){var t=e.translate,n=e.errors,r="".concat(t("react.stockMovement.errors.errorInLine.label","Error occurred in line"),":"),o=n.reduce((function(e,n,r){return[].concat(function(e){if(Array.isArray(e))return d(e)}(o=e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),["".concat(n&&"".concat(r+1," - ").concat(a().map(n,(function(e){return t("".concat(e))}))))]);var o}),[]);(0,s.A)(l.A.ERROR_OUTLINED)({message:r,detailsArray:o})},S=function(e){return a().omitBy(e,(function(e){return!("boolean"==typeof e||"number"==typeof e||e instanceof Date)&&a().isEmpty(e)}))},w=function(e,t,n){var r;return null===(r=(null==e?void 0:e.length)>n?"".concat(a().take(e,n).join(""),"..."):e)||void 0===r?void 0:r.split(t)}},90524:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(96540),o=n(5556),a=n.n(o),i=function(e){var t=e.buttonIcon,n=e.buttonTitle,o=e.link,a=e.target,i=e.disabled,s=e.onClick;return r.createElement("a",{href:o,className:"py-1 mb-1 btn btn-outline-secondary ".concat(i?"disabled":""),target:a,rel:"noopener noreferrer",onClick:function(e){return function(e,t,n){t.preventDefault();var r=window.open("","_blank");e?e().then((function(){r.location.href=n})):r.location.href=n}(s,e,o)}},r.createElement("span",null,r.createElement("i",{className:"pr-2 fa ".concat(t)}),n))};const s=i;i.propTypes={buttonIcon:a().string,buttonTitle:a().string,link:a().string.isRequired,target:a().string,disabled:a().bool.isRequired,onClick:a().func.isRequired},i.defaultProps={buttonIcon:"fa-download",buttonTitle:"Print Document",target:"_blank"}},93638:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(96540),o=n(5556),a=n.n(o),i=n(51836),s=n(26216);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c.apply(null,arguments)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t,n){return(t=function(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(e){var t=e.fieldName,n=e.fieldConfig,o=n.buttonLabel,a=n.buttonDefaultMessage,l=n.getDynamicAttr,u=n.attributes,p=void 0===u?{className:"btn-outline-primary"}:u,m=l?l(e):{},f=d(d({},p),m);return r.createElement("button",c({type:"button",key:t},f,{className:"text-truncate btn btn-xs ".concat(f.className)}),"string"==typeof o?r.createElement(i.Tooltip,{html:o&&r.createElement(s.A,{id:o,defaultMessage:a}),theme:"transparent",arrow:"true",delay:"150",duration:"250",hideDelay:"50"}," ",r.createElement(s.A,{id:o,defaultMessage:a})):r.createElement(o,null))};const f=m;m.propTypes={fieldName:a().string.isRequired,fieldConfig:a().shape({getDynamicAttr:a().func}).isRequired}}}]);
//# sourceMappingURL=bundle.929af1b45eb780bfc503.7936.js.map